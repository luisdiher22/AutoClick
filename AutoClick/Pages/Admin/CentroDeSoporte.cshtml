@page
@model AutoClick.Pages.Admin.CentroSoporteModel
@using AutoClick.Models
@{
    ViewData["Title"] = "Centro de Soporte";
    Layout = "_Layout";
}

<style>
body {
    margin: 0;
    padding: 0;
    background: #02081C !important;
    font-family: 'Montserrat', sans-serif !important;
    overflow-x: hidden;
    color: white;
}

.support-section {
    margin-bottom: 3rem !important;
}

.section-title {
    color: #F7F7F7 !important;
    margin-bottom: 20px !important;
    font-weight: 700;
    font-size: 18px;
}

/* Tabla estilo Figma */
.tabla-figma-wrapper {
    background: rgba(255, 255, 255, 0.15);
    border: 0.5px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    overflow: hidden;
}

.tabla-figma {
    width: 100%;
    margin: 0;
    border-collapse: collapse;
}

.tabla-figma thead th {
    background: transparent;
    border: none;
    border-bottom: 0.5px solid rgba(255, 255, 255, 0.25);
    padding: 15px 32px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 700;
    text-align: left;
}

.tabla-figma tbody tr {
    border-bottom: 0.5px solid rgba(255, 255, 255, 0.25);
    transition: background-color 0.2s ease;
}

.tabla-figma tbody tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.1);
}

.tabla-figma tbody tr:hover {
    background: rgba(255, 147, 30, 0.1);
}

.tabla-figma tbody td {
    padding: 15px 32px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 500;
    border: none;
    vertical-align: middle;
}

.tabla-figma .codigo-col {
    width: 120px;
}

.tabla-figma .nombre-col {
    width: 250px;
}

.tabla-figma .fecha-col {
    width: 130px;
}

.tabla-figma .tipo-col {
    width: 300px;
}

.tabla-figma .accion-col {
    width: 120px;
    text-align: center;
}

/* Botón Revisar estilo Figma */
.btn-revisar-figma {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10.5px 6px 6px;
    background: transparent;
    border: none;
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 4px;
}

.btn-revisar-figma:hover {
    background: #FF931E;
    transform: translateX(4px);
}

.btn-revisar-figma svg {
    transform: rotate(-90deg);
    transition: transform 0.3s ease;
}

.btn-revisar-figma:hover svg {
    transform: rotate(-90deg) translateX(2px);
}

.no-data-text {
    color: #ccc !important;
    margin: 0 !important;
    padding: 2rem !important;
    text-align: center;
}

/* Modal de detalles */
.modal-detalles-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(2, 8, 28, 0.9);
    backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 20px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal-detalles-overlay.active {
    display: flex;
    opacity: 1;
}

.modal-detalles-content {
    background: linear-gradient(135deg, #0a1428 0%, #02081C 100%);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 16px;
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.modal-detalles-overlay.active .modal-detalles-content {
    transform: scale(1);
}

.modal-detalles-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 30px 40px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.25);
}

.modal-detalles-title {
    font-size: 24px;
    font-weight: 700;
    color: #F7F7F7;
    margin: 0;
}

.modal-detalles-close {
    background: transparent;
    border: none;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.modal-detalles-close:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: rotate(90deg);
}

.modal-detalles-body {
    padding: 30px 40px;
}

.modal-field-section {
    margin-bottom: 30px;
}

.modal-field-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.modal-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.modal-field.full-width {
    grid-column: 1 / -1;
}

.modal-field-label {
    font-size: 12px;
    font-weight: 600;
    color: rgba(247, 247, 247, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.modal-field-value {
    font-size: 16px;
    font-weight: 500;
    color: #F7F7F7;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
}

.modal-field-textarea {
    font-size: 16px;
    font-weight: 400;
    color: #F7F7F7;
    padding: 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    line-height: 1.6;
    white-space: pre-wrap;
    word-wrap: break-word;
    min-height: 120px;
}

.modal-detalles-footer {
    display: flex;
    justify-content: flex-end;
    padding: 20px 40px;
    border-top: 1px solid rgba(255, 255, 255, 0.25);
}

.btn-modal-cerrar {
    padding: 12px 32px;
    background: #FF931E;
    border: none;
    border-radius: 8px;
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-modal-cerrar:hover {
    background: #e67e0a;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 147, 30, 0.3);
}

.modal-detalles-content::-webkit-scrollbar {
    width: 8px;
}

.modal-detalles-content::-webkit-scrollbar-track {
    background: #02081C;
}

.modal-detalles-content::-webkit-scrollbar-thumb {
    background: #FF931E;
    border-radius: 4px;
}

.modal-detalles-content::-webkit-scrollbar-thumb:hover {
    background: #e67e0a;
}

/* Estilos de paginación */
.paginacion-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 24px;
    gap: 8px;
}

.btn-paginacion {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 0.5px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
}

.btn-paginacion:hover:not(:disabled) {
    background: rgba(255, 147, 30, 0.2);
    border-color: #FF931E;
    transform: translateY(-2px);
}

.btn-paginacion:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.btn-paginacion.active {
    background: #FF931E;
    border-color: #FF931E;
}

.paginacion-info {
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 500;
    margin: 0 12px;
}

@@media (max-width: 992px) {
    .modal-field-row {
        grid-template-columns: 1fr;
    }
    
    .modal-detalles-header,
    .modal-detalles-body,
    .modal-detalles-footer {
        padding: 20px;
    }
}

@@media (max-width: 768px) {
    .tabla-figma thead th,
    .tabla-figma tbody td {
        padding: 12px 15px;
        font-size: 12px;
    }
}
</style>

<div style="width: 100%; min-height: 100vh; position: relative; background: #02081C; font-family: 'Montserrat', sans-serif;">

    @await Html.PartialAsync("_AdminSidebar")

    <!-- Main Content -->
    <div style="margin-left: 396px; padding: 40px 20px 20px 20px;">

        <h1 style="color: white; margin-bottom: 30px; font-size: 24px; font-weight: 700;">Centro de Soporte</h1>

        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
        {
            <div class="alert alert-success">
                @Model.SuccessMessage
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger">
                @Model.ErrorMessage
            </div>
        }

        <!-- Reclamos Section -->
        <div id="reclamos" class="support-section">
            <h2 class="section-title">Reclamos (@Model.EstadisticasReclamos.GetValueOrDefault("Total", 0))</h2>

            @if (Model.Reclamos.Any())
            {
                <div class="tabla-figma-wrapper">
                    <table class="tabla-figma">
                        <thead>
                            <tr>
                                <th class="codigo-col">Código</th>
                                <th class="nombre-col">Nombre</th>
                                <th class="fecha-col">Fecha</th>
                                <th class="tipo-col">Tipo de reclamo</th>
                                <th class="accion-col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var reclamo in Model.Reclamos.Take(10))
                            {
                                <tr>
                                    <td class="codigo-col">#@reclamo.Id.ToString("D5")</td>
                                    <td class="nombre-col">@reclamo.NombreCompleto</td>
                                    <td class="fecha-col">@reclamo.FechaCreacion.ToString("dd/MM/yy")</td>
                                    <td class="tipo-col">@reclamo.TipoProblema</td>
                                    <td class="accion-col">
                                        <button type="button" class="btn-revisar-figma" 
                                                data-id="@reclamo.Id"
                                                data-tipo="Reclamo"
                                                data-codigo="#REC@reclamo.Id.ToString("D5")"
                                                data-nombre="@reclamo.NombreCompleto"
                                                data-email="@(reclamo.EmailCliente ?? "No proporcionado")"
                                                data-telefono="@(reclamo.Telefono ?? "No proporcionado")"
                                                data-fecha="@reclamo.FechaCreacion.ToString("dd/MM/yyyy")"
                                                data-tipo-detalle="@reclamo.TipoProblema"
                                                data-contenido="@reclamo.Descripcion"
                                                data-estado="@reclamo.EstadoFormateado"
                                                data-prioridad="@reclamo.Prioridad"
                                                onclick="abrirModalDetalles(this)">
                                            <span>Revisar</span>
                                            <svg width="9" height="5" viewBox="0 0 9 5" fill="none">
                                                <path d="M4.5 4.5L0.602886 0L8.39711 0L4.5 4.5Z" fill="white"/>
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginación de Reclamos -->
                @if (Model.TotalPaginasReclamos > 1)
                {
                    <div class="paginacion-wrapper">
                        <a href="?PaginaActualReclamos=@(Model.PaginaActualReclamos - 1)&PaginaActualMensajes=@Model.PaginaActualMensajes" 
                           class="btn-paginacion @(Model.PaginaActualReclamos <= 1 ? "disabled" : "")"
                           style="@(Model.PaginaActualReclamos <= 1 ? "pointer-events: none;" : "")">
                            Anterior
                        </a>
                        
                        <span class="paginacion-info">
                            Página @Model.PaginaActualReclamos de @Model.TotalPaginasReclamos
                        </span>
                        
                        <a href="?PaginaActualReclamos=@(Model.PaginaActualReclamos + 1)&PaginaActualMensajes=@Model.PaginaActualMensajes" 
                           class="btn-paginacion @(Model.PaginaActualReclamos >= Model.TotalPaginasReclamos ? "disabled" : "")"
                           style="@(Model.PaginaActualReclamos >= Model.TotalPaginasReclamos ? "pointer-events: none;" : "")">
                            Siguiente
                        </a>
                    </div>
                }
            }
            else
            {
                <div class="tabla-figma-wrapper">
                    <p class="no-data-text">No hay reclamos registrados.</p>
                </div>
            }
        </div>

        <!-- Mensajes Section -->
        <div id="mensajes" class="support-section">
            <h2 class="section-title">Mensajes (@Model.EstadisticasMensajes.GetValueOrDefault("Total", 0))</h2>

            @if (Model.Mensajes.Any())
            {
                <div class="tabla-figma-wrapper">
                    <table class="tabla-figma">
                        <thead>
                            <tr>
                                <th class="codigo-col">Código</th>
                                <th class="nombre-col">Nombre</th>
                                <th class="fecha-col">Fecha</th>
                                <th class="tipo-col">Tipo de consulta</th>
                                <th class="accion-col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var mensaje in Model.Mensajes.Take(10))
                            {
                                <tr>
                                    <td class="codigo-col">#@mensaje.Id.ToString("D5")</td>
                                    <td class="nombre-col">@mensaje.NombreCompleto</td>
                                    <td class="fecha-col">@mensaje.FechaCreacion.ToString("dd/MM/yy")</td>
                                    <td class="tipo-col">@mensaje.TipoConsulta</td>
                                    <td class="accion-col">
                                        <button type="button" class="btn-revisar-figma"
                                                data-id="@mensaje.Id"
                                                data-tipo="Mensaje"
                                                data-codigo="#MSG@mensaje.Id.ToString("D5")"
                                                data-nombre="@mensaje.NombreCompleto"
                                                data-email="@(mensaje.EmailCliente ?? "No proporcionado")"
                                                data-telefono="@(mensaje.Telefono ?? "No proporcionado")"
                                                data-fecha="@mensaje.FechaCreacion.ToString("dd/MM/yyyy")"
                                                data-tipo-detalle="@mensaje.TipoConsulta"
                                                data-contenido="@mensaje.ContenidoMensaje"
                                                data-estado="@mensaje.EstadoFormateado"
                                                data-prioridad="@mensaje.Prioridad"
                                                onclick="abrirModalDetalles(this)">
                                            <span>Revisar</span>
                                            <svg width="9" height="5" viewBox="0 0 9 5" fill="none">
                                                <path d="M4.5 4.5L0.602886 0L8.39711 0L4.5 4.5Z" fill="white"/>
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginación de Mensajes -->
                @if (Model.TotalPaginasMensajes > 1)
                {
                    <div class="paginacion-wrapper">
                        <a href="?PaginaActualReclamos=@Model.PaginaActualReclamos&PaginaActualMensajes=@(Model.PaginaActualMensajes - 1)" 
                           class="btn-paginacion @(Model.PaginaActualMensajes <= 1 ? "disabled" : "")"
                           style="@(Model.PaginaActualMensajes <= 1 ? "pointer-events: none;" : "")">
                            Anterior
                        </a>
                        
                        <span class="paginacion-info">
                            Página @Model.PaginaActualMensajes de @Model.TotalPaginasMensajes
                        </span>
                        
                        <a href="?PaginaActualReclamos=@Model.PaginaActualReclamos&PaginaActualMensajes=@(Model.PaginaActualMensajes + 1)" 
                           class="btn-paginacion @(Model.PaginaActualMensajes >= Model.TotalPaginasMensajes ? "disabled" : "")"
                           style="@(Model.PaginaActualMensajes >= Model.TotalPaginasMensajes ? "pointer-events: none;" : "")">
                            Siguiente
                        </a>
                    </div>
                }
            }
            else
            {
                <div class="tabla-figma-wrapper">
                    <p class="no-data-text">No hay mensajes registrados.</p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal de Detalles (Solo lectura) -->
<div id="modalDetalles" class="modal-detalles-overlay" onclick="cerrarModalSiClickFuera(event)">
    <div class="modal-detalles-content" onclick="event.stopPropagation()">
        <div class="modal-detalles-header">
            <h2 class="modal-detalles-title" id="modal-titulo">Detalles del Mensaje</h2>
            <button type="button" class="modal-detalles-close" onclick="cerrarModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <div class="modal-detalles-body">
            <!-- Información principal -->
            <div class="modal-field-section">
                <div class="modal-field-row">
                    <div class="modal-field">
                        <span class="modal-field-label">Nombre Completo:</span>
                        <span class="modal-field-value" id="modal-nombre"></span>
                    </div>
                    <div class="modal-field">
                        <span class="modal-field-label">Fecha:</span>
                        <span class="modal-field-value" id="modal-fecha"></span>
                    </div>
                </div>

                <div class="modal-field-row">
                    <div class="modal-field">
                        <span class="modal-field-label">Email:</span>
                        <span class="modal-field-value" id="modal-email"></span>
                    </div>
                    <div class="modal-field">
                        <span class="modal-field-label">Teléfono:</span>
                        <span class="modal-field-value" id="modal-telefono"></span>
                    </div>
                </div>

                <div class="modal-field-row">
                    <div class="modal-field full-width">
                        <span class="modal-field-label">Tipo de Consulta/Problema:</span>
                        <span class="modal-field-value" id="modal-tipo-detalle"></span>
                    </div>
                </div>
            </div>

            <!-- Contenido del mensaje -->
            <div class="modal-field-section">
                <div class="modal-field full-width">
                    <span class="modal-field-label">Mensaje / Descripción:</span>
                    <div class="modal-field-textarea" id="modal-contenido"></div>
                </div>
            </div>
        </div>

        <div class="modal-detalles-footer">
            <button type="button" class="btn-modal-cerrar" onclick="cerrarModal()">
                Cerrar
            </button>
        </div>
    </div>
</div>

@section Scripts {
<script>
// Abrir modal con los datos del item
function abrirModalDetalles(button) {
    // Obtener datos de los data-attributes
    const tipo = button.getAttribute('data-tipo');
    const nombre = button.getAttribute('data-nombre');
    const email = button.getAttribute('data-email');
    const telefono = button.getAttribute('data-telefono');
    const fecha = button.getAttribute('data-fecha');
    const tipoDetalle = button.getAttribute('data-tipo-detalle');
    const contenido = button.getAttribute('data-contenido');

    // Llenar el modal con los datos
    document.getElementById('modal-titulo').textContent = `Detalles del ${tipo}`;
    document.getElementById('modal-nombre').textContent = nombre;
    document.getElementById('modal-email').textContent = email;
    document.getElementById('modal-telefono').textContent = telefono;
    document.getElementById('modal-fecha').textContent = fecha;
    document.getElementById('modal-tipo-detalle').textContent = tipoDetalle;
    document.getElementById('modal-contenido').textContent = contenido;

    // Mostrar el modal con animación
    const modal = document.getElementById('modalDetalles');
    modal.classList.add('active');
    
    // Prevenir scroll del body
    document.body.style.overflow = 'hidden';
}

// Cerrar modal
function cerrarModal() {
    const modal = document.getElementById('modalDetalles');
    modal.classList.remove('active');
    
    // Restaurar scroll del body
    document.body.style.overflow = '';
}

// Cerrar modal al hacer clic fuera
function cerrarModalSiClickFuera(event) {
    if (event.target.id === 'modalDetalles') {
        cerrarModal();
    }
}

// Manejo de teclado - ESC para cerrar
document.addEventListener('keydown', function(event) {
    const modal = document.getElementById('modalDetalles');
    
    if (event.key === 'Escape' && modal.classList.contains('active')) {
        cerrarModal();
    }
});
</script>
}
