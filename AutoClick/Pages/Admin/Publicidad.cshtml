@page
@model AutoClick.Pages.Admin.PublicidadModel
@{
    ViewData["Title"] = "Gestión de Publicidad";
    Layout = "_Layout";
}

<style>
body {
    margin: 0;
    padding: 0;
    background: #02081C !important;
    font-family: 'Montserrat', sans-serif !important;
    overflow-x: hidden;
    color: white;
}

.support-section {
    margin-bottom: 3rem !important;
}

.section-title {
    color: #F7F7F7 !important;
    margin-bottom: 20px !important;
    font-weight: 700;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.add-button {
    background-color: transparent;
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.add-button:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.add-button-text {
    font-size: 16px;
    font-weight: 700;
    color: white;
}

/* Tabla estilo Figma */
.tabla-figma-wrapper {
    background: rgba(255, 255, 255, 0.15);
    border: 0.5px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    overflow: hidden;
}

.tabla-figma {
    width: 100%;
    margin: 0;
    border-collapse: collapse;
}

.tabla-figma thead th {
    background: transparent;
    border: none;
    border-bottom: 0.5px solid rgba(255, 255, 255, 0.25);
    padding: 15px 32px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 700;
    text-align: left;
}

.tabla-figma tbody tr {
    border-bottom: 0.5px solid rgba(255, 255, 255, 0.25);
    transition: background-color 0.2s ease;
}

.tabla-figma tbody tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.1);
}

.tabla-figma tbody tr:hover {
    background: rgba(255, 147, 30, 0.1);
}

.tabla-figma tbody td {
    padding: 15px 32px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 500;
    border: none;
    vertical-align: middle;
}

.btn-revisar-figma {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10.5px 6px 6px;
    background: transparent;
    border: none;
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 4px;
    text-decoration: none;
}

.btn-revisar-figma:hover {
    background: #FF931E;
    transform: translateX(4px);
}

.delete-icon-btn {
    background-color: transparent;
    border: none;
    padding: 8px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.delete-icon-btn:hover {
    background-color: rgba(255, 69, 58, 0.2);
}

.no-data-text {
    color: #ccc !important;
    margin: 0 !important;
    padding: 2rem !important;
    text-align: center;
}

/* Estilos de paginación */
.paginacion-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 24px;
    gap: 8px;
}

.btn-paginacion {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 0.5px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
}

.btn-paginacion:hover:not(:disabled) {
    background: rgba(255, 147, 30, 0.2);
    border-color: #FF931E;
    transform: translateY(-2px);
}

.btn-paginacion:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.paginacion-info {
    color: #F7F7F7;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 500;
    margin: 0 12px;
}

/* Modal de detalles - ESTILO CENTRO DE SOPORTE */
.modal-detalles-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(2, 8, 28, 0.9);
    backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 20px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal-detalles-overlay.active {
    display: flex;
    opacity: 1;
}

.modal-detalles-content {
    background: linear-gradient(135deg, #0a1428 0%, #02081C 100%);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.modal-detalles-overlay.active .modal-detalles-content {
    transform: scale(1);
}

.modal-detalles-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 30px 40px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.25);
}

.modal-detalles-title {
    font-size: 24px;
    font-weight: 700;
    color: #F7F7F7;
    margin: 0;
}

.modal-detalles-close {
    background: transparent;
    border: none;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.modal-detalles-close:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: rotate(90deg);
}

.modal-detalles-body {
    padding: 30px 40px;
}

.modal-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
}

.modal-field-label {
    font-size: 12px;
    font-weight: 600;
    color: rgba(247, 247, 247, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.modal-field-value {
    font-size: 16px;
    font-weight: 500;
    color: #F7F7F7;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
}

.modal-field-input {
    font-size: 16px;
    font-weight: 500;
    color: #F7F7F7;
    padding: 12px 16px;
    background: #02081C;
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
}

.modal-field-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.modal-field-input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.8);
}

.modal-field-select {
    font-size: 16px;
    font-weight: 500;
    color: #F7F7F7;
    padding: 12px 16px;
    background: #02081C;
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
    cursor: pointer;
}

.modal-detalles-footer {
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    padding: 20px 40px;
    border-top: 1px solid rgba(255, 255, 255, 0.25);
}

.btn-modal-cerrar {
    padding: 12px 32px;
    background: transparent;
    border: 1px solid white;
    border-radius: 8px;
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-modal-cerrar:hover {
    background: rgba(255, 255, 255, 0.1);
}

.btn-modal-submit {
    padding: 12px 32px;
    background: #FF931E;
    border: none;
    border-radius: 8px;
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-modal-submit:hover {
    background: #e67e0a;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 147, 30, 0.3);
}

.alert {
    padding: 12px 16px;
    border-radius: 4px;
    margin-bottom: 16px;
    font-size: 14px;
    font-weight: 500;
}

.alert-success {
    background-color: rgba(52, 199, 89, 0.2);
    border: 1px solid rgba(52, 199, 89, 0.5);
    color: #34c759;
}

.alert-danger {
    background-color: rgba(255, 69, 58, 0.2);
    border: 1px solid rgba(255, 69, 58, 0.5);
    color: #ff453a;
}

.required {
    color: red;
}
</style>

<div style="width: 100%; min-height: 100vh; position: relative; background: #02081C; font-family: 'Montserrat', sans-serif;">

    @await Html.PartialAsync("_AdminSidebar")

    <!-- Main Content -->
    <div style="margin-left: 396px; padding: 40px 20px 20px 20px;">

        <h1 style="color: white; margin-bottom: 30px; font-size: 24px; font-weight: 700;">Gestión de Publicidad</h1>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                @TempData["ErrorMessage"]
            </div>
        }

        <!-- Empresas Activas Section -->
        <div id="empresas-activas" class="support-section">
            <div class="header-section">
                <h2 class="section-title">
                    <span>Empresas activas</span>
                    <span style="transform: rotate(90deg); font-size: 16px;">›</span>
                </h2>
                <button class="add-button" onclick="openModal()">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="16" cy="16" r="16" fill="rgba(255, 255, 255, 0.2)"/>
                        <path d="M16 10V22M10 16H22" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span class="add-button-text">Añadir nueva empresa</span>
                </button>
            </div>

            @if (Model.EmpresasActivas != null && Model.EmpresasActivas.Any())
            {
                <div class="tabla-figma-wrapper">
                    <table class="tabla-figma">
                        <thead>
                            <tr>
                                <th>Fecha inicio</th>
                                <th>Empresa</th>
                                <th>Activos</th>
                                <th>Inactivos</th>
                                <th>Cobros</th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var empresa in Model.EmpresasActivas)
                            {
                                <tr>
                                    <td>@empresa.FechaInicio.ToString("M/d/yy")</td>
                                    <td>@empresa.NombreEmpresa</td>
                                    <td>@empresa.AnunciosActivos</td>
                                    <td>@empresa.AnunciosInactivos</td>
                                    <td>@empresa.EstadoCobros</td>
                                    <td>
                                        <a href="/Admin/DetallePublicidadEmpresa?id=@empresa.Id" class="btn-revisar-figma">
                                            <span>Revisar</span>
                                            <svg width="9" height="5" viewBox="0 0 9 5" fill="none">
                                                <path d="M4.5 4.5L0.602886 0L8.39711 0L4.5 4.5Z" fill="white" transform="rotate(-90 4.5 2.5)"/>
                                            </svg>
                                        </a>
                                    </td>
                                    <td>
                                        <button type="button" class="delete-icon-btn" title="Eliminar empresa" onclick="abrirModalEliminar(@empresa.Id)">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2 4H14M12.6667 4V13.3333C12.6667 14 12 14.6667 11.3333 14.6667H4.66667C4 14.6667 3.33333 14 3.33333 13.3333V4M5.33333 4V2.66667C5.33333 2 6 1.33333 6.66667 1.33333H9.33333C10 1.33333 10.6667 2 10.6667 2.66667V4" stroke="#ff453a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M6.66667 7.33333V11.3333M9.33333 7.33333V11.3333" stroke="#ff453a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (Model.TotalPaginasActivas > 1)
                {
                    <div class="paginacion-wrapper">
                        <a href="?paginaActivas=@(Model.PaginaActualActivas - 1)&paginaInactivas=@Model.PaginaActualInactivas" 
                           class="btn-paginacion @(Model.PaginaActualActivas <= 1 ? "disabled" : "")"
                           style="@(Model.PaginaActualActivas <= 1 ? "pointer-events: none;" : "")">
                            Anterior
                        </a>
                        <span class="paginacion-info">
                            Página @Model.PaginaActualActivas de @Model.TotalPaginasActivas
                        </span>
                        <a href="?paginaActivas=@(Model.PaginaActualActivas + 1)&paginaInactivas=@Model.PaginaActualInactivas" 
                           class="btn-paginacion @(Model.PaginaActualActivas >= Model.TotalPaginasActivas ? "disabled" : "")"
                           style="@(Model.PaginaActualActivas >= Model.TotalPaginasActivas ? "pointer-events: none;" : "")">
                            Siguiente
                        </a>
                    </div>
                }
            }
            else
            {
                <div class="tabla-figma-wrapper">
                    <p class="no-data-text">No hay empresas activas.</p>
                </div>
            }
        </div>

        <!-- Empresas Inactivas Section -->
        <div id="empresas-inactivas" class="support-section">
            <h2 class="section-title">
                <span>Empresas inactivas</span>
                <span style="transform: rotate(90deg); font-size: 16px;">›</span>
            </h2>

            @if (Model.EmpresasInactivas != null && Model.EmpresasInactivas.Any())
            {
                <div class="tabla-figma-wrapper">
                    <table class="tabla-figma">
                        <thead>
                            <tr>
                                <th>Fecha de salida</th>
                                <th>Empresa</th>
                                <th>Anuncios inactivos</th>
                                <th>Cobros</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var empresa in Model.EmpresasInactivas)
                            {
                                <tr>
                                    <td>@(empresa.FechaSalida?.ToString("M/d/yy") ?? "N/A")</td>
                                    <td>@empresa.NombreEmpresa</td>
                                    <td>@empresa.AnunciosInactivos</td>
                                    <td>Sin cobros</td>
                                    <td>
                                        <a href="/Admin/DetallePublicidadEmpresa?id=@empresa.Id" class="btn-revisar-figma">
                                            <span>Revisar</span>
                                            <svg width="9" height="5" viewBox="0 0 9 5" fill="none">
                                                <path d="M4.5 4.5L0.602886 0L8.39711 0L4.5 4.5Z" fill="white" transform="rotate(-90 4.5 2.5)"/>
                                            </svg>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (Model.TotalPaginasInactivas > 1)
                {
                    <div class="paginacion-wrapper">
                        <a href="?paginaActivas=@Model.PaginaActualActivas&paginaInactivas=@(Model.PaginaActualInactivas - 1)" 
                           class="btn-paginacion @(Model.PaginaActualInactivas <= 1 ? "disabled" : "")"
                           style="@(Model.PaginaActualInactivas <= 1 ? "pointer-events: none;" : "")">
                            Anterior
                        </a>
                        <span class="paginacion-info">
                            Página @Model.PaginaActualInactivas de @Model.TotalPaginasInactivas
                        </span>
                        <a href="?paginaActivas=@Model.PaginaActualActivas&paginaInactivas=@(Model.PaginaActualInactivas + 1)" 
                           class="btn-paginacion @(Model.PaginaActualInactivas >= Model.TotalPaginasInactivas ? "disabled" : "")"
                           style="@(Model.PaginaActualInactivas >= Model.TotalPaginasInactivas ? "pointer-events: none;" : "")">
                            Siguiente
                        </a>
                    </div>
                }
            }
            else
            {
                <div class="tabla-figma-wrapper">
                    <p class="no-data-text">No hay empresas inactivas.</p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal Añadir Empresa - ESTILO CENTRO DE SOPORTE -->
<div id="modalAgregarEmpresa" class="modal-detalles-overlay" onclick="cerrarModalSiClickFuera(event)">
    <div class="modal-detalles-content" onclick="event.stopPropagation()">
        <div class="modal-detalles-header">
            <h2 class="modal-detalles-title">Añadir nueva empresa</h2>
            <button type="button" class="modal-detalles-close" onclick="closeModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <form method="post" asp-page-handler="AgregarEmpresa">
            <div class="modal-detalles-body">
                <div class="modal-field">
                    <span class="modal-field-label">Nombre de la empresa <span class="required">*</span></span>
                    <input type="text" asp-for="NombreEmpresa" class="modal-field-input" placeholder="Introducir nombre" required />
                </div>

                <div class="modal-field">
                    <span class="modal-field-label">Fecha de inicio</span>
                    <div class="modal-field-value">@DateTime.Now.ToString("M/d/yy")</div>
                    <input type="hidden" asp-for="FechaInicio" value="@DateTime.Now" />
                </div>

                <div class="modal-field">
                    <span class="modal-field-label">Estado de cobros <span class="required">*</span></span>
                    <select asp-for="EstadoCobros" class="modal-field-select" required>
                        <option value="">Seleccionar estado</option>
                        <option value="Al día">Al día</option>
                        <option value="Pendiente">Pendiente</option>
                    </select>
                </div>
            </div>

            <div class="modal-detalles-footer">
                <button type="button" class="btn-modal-cerrar" onclick="closeModal()">Cancelar</button>
                <button type="submit" class="btn-modal-submit">Agregar empresa</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de Confirmación para Eliminar Empresa -->
<div id="modalConfirmarEliminar" class="modal-detalles-overlay" onclick="cerrarModalEliminar(event)">
    <div class="modal-detalles-content" onclick="event.stopPropagation()" style="max-width: 500px;">
        <div class="modal-detalles-header">
            <h2 class="modal-detalles-title">⚠️ Confirmar eliminación</h2>
            <button type="button" class="modal-detalles-close" onclick="cerrarModalEliminar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <form method="post" asp-page-handler="EliminarEmpresa" id="formEliminarEmpresa">
            @Html.AntiForgeryToken()
            <input type="hidden" id="empresaIdEliminar" name="id" value="" />
            
            <div class="modal-detalles-body">
                <p style="color: white; font-size: 16px; line-height: 1.5; margin: 0 0 16px 0;">
                    ¿Está seguro de que desea <strong style="color: #ff453a;">eliminar esta empresa y TODOS sus anuncios</strong>?
                </p>
                <p style="color: rgba(255, 255, 255, 0.7); font-size: 14px; line-height: 1.5; margin: 0;">
                    <strong>Esta acción es permanente y no se puede deshacer.</strong> Se eliminarán todos los anuncios asociados (activos e inactivos) y toda la información de la empresa.
                </p>
            </div>

            <div class="modal-detalles-footer">
                <button type="button" class="btn-modal-cerrar" onclick="cerrarModalEliminar()">
                    Cancelar
                </button>
                <button type="submit" class="btn-modal-submit" style="background: #ff453a;">
                    Sí, eliminar empresa
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
<script>
let empresaIdAEliminar = null;

function abrirModalEliminar(empresaId) {
    empresaIdAEliminar = empresaId;
    document.getElementById('empresaIdEliminar').value = empresaId;
    document.getElementById('modalConfirmarEliminar').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function cerrarModalEliminar(event) {
    // Si se pasó un event y el click no fue en el overlay, no hacer nada
    if (event && event.target.id !== 'modalConfirmarEliminar') {
        return;
    }
    
    document.getElementById('modalConfirmarEliminar').classList.remove('active');
    document.body.style.overflow = '';
    empresaIdAEliminar = null;
}

function openModal() {
    const modal = document.getElementById('modalAgregarEmpresa');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    const modal = document.getElementById('modalAgregarEmpresa');
    modal.classList.remove('active');
    document.body.style.overflow = '';
}

function cerrarModalSiClickFuera(event) {
    if (event.target.id === 'modalAgregarEmpresa') {
        closeModal();
    }
}

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modalAgregar = document.getElementById('modalAgregarEmpresa');
        const modalEliminar = document.getElementById('modalConfirmarEliminar');
        
        if (modalAgregar && modalAgregar.classList.contains('active')) {
            closeModal();
        }
        
        if (modalEliminar && modalEliminar.classList.contains('active')) {
            cerrarModalEliminar();
        }
    }
});
</script>
}
