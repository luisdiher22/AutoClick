@page
@model AutoClick.Pages.ConfiguracionCuentaModel
@{
    ViewData["Title"] = "Configuración de cuenta - AutoClick.cr";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<partial name="~/Pages/Shared/_Header.cshtml" />

<div class="page-wrapper">
    <div class="configuracion-cuenta-container">
    <!-- Sidebar -->
    <div class="account-sidebar">
        <div class="sidebar-nav">
            <a href="/MiPerfil" class="nav-item">
                <div class="personal-icon"></div>
                <span>Información de contacto</span>
            </a>
            <a href="/HistorialPagos" class="nav-item">
                <div class="payments-icon"></div>
                <span>Historial de pagos</span>
            </a>
            <a href="/ConfiguracionCuenta" class="nav-item active">
                <div class="settings-icon"></div>
                <span>Configuración de cuenta</span>
            </a>
        </div>
        <div class="sidebar-indicator"></div>
    </div>

    <!-- Main Content -->
    <div class="account-content">
        <div class="page-header">
            <h1 class="page-title">Configuración de cuenta</h1>
        </div>

        <!-- Success/Error Messages -->
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }
        
        @if (TempData["AccountDeleted"] != null)
        {
            <div class="alert alert-info">
                @TempData["AccountDeleted"]
            </div>
        }

        <!-- Account Settings Form -->
        <form method="post" class="account-form" asp-page-handler="UpdateAccount">
            <div asp-validation-summary="All" class="validation-summary"></div>
            
            <!-- Email Section -->
            <div class="form-section">
                <div class="form-group">
                    <label for="Email">Correo electrónico</label>
                    <input asp-for="Email" type="email" class="form-input" readonly />
                    <div class="form-actions">
                        <button type="button" class="change-email-btn" onclick="showChangeEmail()">
                            Cambiar correo electrónico
                        </button>
                    </div>
                </div>
            </div>

            <!-- Password Section -->
            <div class="form-section">
                <div class="form-group">
                    <label for="CurrentPassword">Contraseña</label>
                    <input type="password" class="form-input" value="********************" readonly />
                    <div class="form-actions">
                        <button type="button" class="forgot-password-btn" onclick="showForgotPassword()">
                            ¿Olvidó su contraseña?
                        </button>
                        <button type="button" class="change-password-btn" onclick="showChangePassword()">
                            Deseo cambiar mi contraseña
                        </button>
                    </div>
                </div>
            </div>

            <!-- Delete Account Section -->
            <div class="danger-section">
                <button type="button" class="delete-account-btn" onclick="showDeleteAccountModal()">
                    <svg width="17" height="19" viewBox="0 0 17 19" fill="none">
                        <path d="M1 4.5H16M14.5 4.5V16C14.5 16.5304 14.2893 17.0391 13.9142 17.4142C13.5391 17.7893 13.0304 18 12.5 18H4.5C3.96957 18 3.46086 17.7893 3.08579 17.4142C2.71071 17.0391 2.5 16.5304 2.5 16V4.5M5.5 4.5V2.5C5.5 2.23478 5.60536 1.98043 5.79289 1.79289C5.98043 1.60536 6.23478 1.5 6.5 1.5H10.5C10.7652 1.5 11.0196 1.60536 11.2071 1.79289C11.3946 1.98043 11.5 2.23478 11.5 2.5V4.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Eliminar cuenta
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Change Email Modal -->
<div id="changeEmailModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Cambiar correo electrónico</h3>
            <button type="button" class="modal-close" onclick="closeModal('changeEmailModal')">&times;</button>
        </div>
        <form method="post" asp-page-handler="ChangeEmail" class="modal-form">
            <div class="form-group">
                <label for="NewEmail">Nuevo correo electrónico</label>
                <input asp-for="NewEmail" type="email" class="form-input" required />
                <span asp-validation-for="NewEmail" class="validation-message"></span>
            </div>
            <div class="form-group">
                <label for="ConfirmEmail">Confirmar correo electrónico</label>
                <input asp-for="ConfirmEmail" type="email" class="form-input" required />
                <span asp-validation-for="ConfirmEmail" class="validation-message"></span>
            </div>
            <div class="form-group">
                <label for="CurrentPasswordForEmail">Contraseña actual</label>
                <input asp-for="CurrentPasswordForEmail" type="password" class="form-input" required />
                <span asp-validation-for="CurrentPasswordForEmail" class="validation-message"></span>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-primary">Cambiar correo</button>
                <button type="button" class="btn-secondary" onclick="closeModal('changeEmailModal')">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Cambiar contraseña</h3>
            <button type="button" class="modal-close" onclick="closeModal('changePasswordModal')">&times;</button>
        </div>
        <form method="post" asp-page-handler="ChangePassword" class="modal-form">
            <div class="form-group">
                <label for="CurrentPassword">Contraseña actual</label>
                <input asp-for="CurrentPassword" type="password" class="form-input" required />
                <span asp-validation-for="CurrentPassword" class="validation-message"></span>
            </div>
            <div class="form-group">
                <label for="NewPassword">Nueva contraseña</label>
                <input asp-for="NewPassword" type="password" class="form-input" required />
                <span asp-validation-for="NewPassword" class="validation-message"></span>
            </div>
            <div class="form-group">
                <label for="ConfirmPassword">Confirmar nueva contraseña</label>
                <input asp-for="ConfirmPassword" type="password" class="form-input" required />
                <span asp-validation-for="ConfirmPassword" class="validation-message"></span>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-primary">Cambiar contraseña</button>
                <button type="button" class="btn-secondary" onclick="closeModal('changePasswordModal')">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Recuperar contraseña</h3>
            <button type="button" class="modal-close" onclick="closeModal('forgotPasswordModal')">&times;</button>
        </div>
        <form method="post" asp-page-handler="ForgotPassword" class="modal-form">
            <p class="modal-description">
                Te enviaremos un enlace para restablecer tu contraseña a tu correo electrónico.
            </p>
            <div class="form-group">
                <label for="ForgotPasswordEmail">Correo electrónico</label>
                <input asp-for="ForgotPasswordEmail" type="email" class="form-input" required />
                <span asp-validation-for="ForgotPasswordEmail" class="validation-message"></span>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-primary">Enviar enlace</button>
                <button type="button" class="btn-secondary" onclick="closeModal('forgotPasswordModal')">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Account Modal -->
<div id="deleteAccountModal" class="modal-overlay" style="display: none;">
    <div class="modal-content danger-modal">
        <div class="modal-header">
            <h3>Eliminar cuenta</h3>
            <button type="button" class="modal-close" onclick="closeModal('deleteAccountModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p class="danger-warning">
                <strong>¡ADVERTENCIA!</strong> Esta acción no se puede deshacer.
            </p>
            <p class="modal-description">
                Al eliminar tu cuenta, perderás todos tus datos, anuncios y configuraciones de forma permanente.
            </p>
            <form method="post" asp-page-handler="DeleteAccount" class="modal-form">
                <div class="form-group">
                    <label for="DeleteConfirmPassword">Para confirmar, ingresa tu contraseña:</label>
                    <input asp-for="DeleteConfirmPassword" type="password" class="form-input" required />
                    <span asp-validation-for="DeleteConfirmPassword" class="validation-message"></span>
                </div>
                <div class="checkbox-group">
                    <input asp-for="ConfirmDeletion" type="checkbox" id="confirmDeletion" required />
                    <label for="confirmDeletion">Entiendo que esta acción es irreversible</label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-danger">Eliminar cuenta permanentemente</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('deleteAccountModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/configuracion-cuenta.css" />
}

@section Scripts {
    <script src="~/js/configuracion-cuenta.js"></script>
}

