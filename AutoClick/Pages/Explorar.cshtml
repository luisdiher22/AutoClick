@page "/explorar"
@model ExplorarModel
@{
    ViewData["Title"] = "Explorar todos los autos - AutoClick.cr";
}

<!-- Header -->
<!-- Header removed - Using universal header -->
    <div class="logo-container">
        <a asp-page="/Index">
            <img src="~/images/logos/autoclick-logo-hd.png" alt="AutoClick.cr" style="height: 23px;" />
        </a>
    </div>
    
    <nav class="nav-menu">
        <div>
            <img src="~/images/costa-rica-flag.png" alt="Costa Rica" style="width: 67px; height: 31px;" />
        </div>
        <div class="nav-dropdown-container">
            <a href="#" class="nav-item nav-dropdown">Anúnciese</a>
            <div class="dropdown-menu">
                <a asp-page="/AnunciarEmpresa" class="dropdown-item">Anuncie su empresa</a>
            </div>
        </div>
        <div class="nav-dropdown-container">
            <a href="#" class="nav-item nav-dropdown">Productos & Servicios</a>
            <div class="dropdown-menu">
                <a asp-page="/PpfCeramico" class="dropdown-item">PPF y Cerámico</a>
                <a asp-page="/RaloyDetailing" class="dropdown-item">Raloy - Detailing</a>
            </div>
        </div>
        <div class="nav-dropdown-container">
            <a href="#" class="nav-item nav-dropdown">Financiamiento</a>
            <div class="dropdown-menu">
                <a asp-page="/Gumout" class="dropdown-item">Gumout</a>
            </div>
        </div>
    </nav>
    
    <div class="header-actions">
        <div style="border-radius: 4px; padding: 12px; border: 2px solid white;">
            <div style="width: 20px; height: 17px; border: 2px solid white;"></div>
        </div>
        <a href="#" class="login-btn">
            <div style="width: 5px; height: 5px; background: white; margin-right: 5px;"></div>
            <div style="width: 10px; height: 6px; background: white; margin-right: 8px;"></div>
            Nombre A.
        </a>
    </div>
</header>

<!-- Page Content -->
<div class="explorar-container">
    <!-- Breadcrumb Navigation -->
    <nav class="explorar-breadcrumb">
        <a asp-page="/Index" class="breadcrumb-link">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Explorar todos los autos</span>
    </nav>

    <div class="explorar-content">
        <!-- Sidebar Filters -->
        <aside class="explorar-sidebar">
            <div class="filters-container">
                <!-- Applied Filters -->
                <div class="filters-header">
                    <h3 class="filters-title">Filtros de búsqueda</h3>
                    <div class="applied-filters">
                        <span class="filter-tag">Alajuela <button class="remove-filter">×</button></span>
                        <span class="filter-tag">San Antonio <button class="remove-filter">×</button></span>
                    </div>
                    <div class="applied-filters">
                        <span class="filter-tag">Toyota <button class="remove-filter">×</button></span>
                        <span class="filter-tag">Corolla <button class="remove-filter">×</button></span>
                    </div>
                </div>

                <!-- Filter Form -->
                <form method="get" class="filters-form">
                    <input type="hidden" name="page" value="1" />
                    <input type="hidden" name="sortBy" value="@Model.SortBy" />

                    <!-- Provincia -->
                    <div class="filter-group">
                        <label class="filter-label">Provincia</label>
                        <select name="province" class="filter-select">
                            <option value="">Todas las provincias</option>
                            <option value="san-jose">San José</option>
                            <option value="alajuela">Alajuela</option>
                            <option value="cartago">Cartago</option>
                        </select>
                    </div>

                    <!-- Cantón -->
                    <div class="filter-group">
                        <label class="filter-label">Cantón</label>
                        <select name="canton" class="filter-select">
                            <option value="">Todos los cantones</option>
                            <option value="san-antonio">San Antonio</option>
                            <option value="escazu">Escazú</option>
                        </select>
                    </div>

                    <!-- Marca -->
                    <div class="filter-group">
                        <label class="filter-label">Marca</label>
                        <select name="brand" class="filter-select">
                            <option value="">Todas las marcas</option>
                            <option value="BMW">BMW</option>
                            <option value="Mercedes-Benz">Mercedes-Benz</option>
                            <option value="Audi">Audi</option>
                            <option value="Toyota">Toyota</option>
                        </select>
                    </div>

                    <!-- Modelo -->
                    <div class="filter-group">
                        <label class="filter-label">Modelo</label>
                        <select name="model" class="filter-select">
                            <option value="">Todos los modelos</option>
                            <option value="Corolla">Corolla</option>
                            <option value="Camry">Camry</option>
                        </select>
                    </div>

                    <!-- Rango de precio -->
                    <div class="filter-group">
                        <label class="filter-label">Rango de precio</label>
                        <div class="price-range">
                            <div class="price-input">
                                <label>Min</label>
                                <input type="number" name="minPrice" placeholder="$" class="price-field" value="@Model.MinPrice" />
                            </div>
                            <span class="price-separator">hasta</span>
                            <div class="price-input">
                                <label>Max</label>
                                <input type="number" name="maxPrice" placeholder="$" class="price-field" value="@Model.MaxPrice" />
                            </div>
                        </div>
                    </div>

                    <!-- Kilometraje -->
                    <div class="filter-group">
                        <label class="filter-label">Kilometraje</label>
                        <div class="price-range">
                            <div class="price-input">
                                <label>Min</label>
                                <input type="number" name="minKm" class="price-field" value="@Model.MinKm" />
                            </div>
                            <span class="price-separator">hasta</span>
                            <div class="price-input">
                                <label>Max</label>
                                <input type="number" name="maxKm" class="price-field" value="@Model.MaxKm" />
                            </div>
                        </div>
                    </div>

                    <!-- Año -->
                    <div class="filter-group">
                        <label class="filter-label">Año</label>
                        <div class="price-range">
                            <div class="price-input">
                                <label>Min</label>
                                <select name="minYear" class="filter-select">
                                    <option value="">Cualquiera</option>
                                    <option value="2020">2020</option>
                                    <option value="2021">2021</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                            <span class="price-separator">hasta</span>
                            <div class="price-input">
                                <label>Max</label>
                                <select name="maxYear" class="filter-select">
                                    <option value="">Cualquiera</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Filters -->
                    <div class="additional-filters">
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Carrocería</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Combustible/Propulsión</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Tracción</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Tipo de vendedor</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Condición</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Transmisión</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Pasajeros</div>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown-header">Extras</div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Sidebar Advertisement -->
            @await Component.InvokeAsync("CarruselPublicidad", new { formato = "cuadrado", seccion = "explorar-sidebar" })
        </aside>

        <!-- Main Content -->
        <main class="explorar-main">
            <!-- Sort Dropdown -->
            <div class="sort-header">
                <select class="explorar-sort-select" onchange="changeExplorarSorting(this.value)">
                    <option value="recent" selected="@(Model.SortBy == "recent")">Ordenar por: Más recientes</option>
                    <option value="price-asc" selected="@(Model.SortBy == "price-asc")">Ordenar por: Precio menor a mayor</option>
                    <option value="price-desc" selected="@(Model.SortBy == "price-desc")">Ordenar por: Precio mayor a menor</option>
                    <option value="year" selected="@(Model.SortBy == "year")">Ordenar por: Año más nuevo</option>
                </select>
            </div>

            <!-- Cars Grid - 2 Columns -->
            <div class="explorar-cars-grid">
                @foreach (var auto in Model.Autos)
                {
                    <div class="explorar-auto-card">
                        <a asp-page="/Producto" asp-route-id="@auto.Id" class="explorar-auto-card-link">
                            <!-- Car Image -->
                            <div class="explorar-auto-card-image">
                                <img src="@auto.ImagenPrincipal" alt="@auto.NombreCompleto" />
                                
                                @* Badge destacado si tiene plan de visibilidad mayor a 0 *@
                                @if (auto.PlanVisibilidad > 0)
                                {
                                    <div class="explorar-destacado-badge">Destacado</div>
                                }
                                
                                @* Banderín si tiene banderín adquirido *@
                                @if (auto.BanderinAdquirido > 0 && !string.IsNullOrEmpty(auto.BanderinVideoUrl))
                                {
                                    <div class="explorar-banderin-badge">
                                        <img src="https://autoclickstorage.blob.core.windows.net/banderin/@auto.BanderinVideoUrl" 
                                             alt="Banderín" />
                                    </div>
                                }
                            </div>

                            <!-- Car Info -->
                            <div class="explorar-auto-card-info">
                                <div class="explorar-auto-card-header">
                                    <div>
                                        <div class="explorar-auto-card-title">@auto.NombreCompleto</div>
                                        <div class="explorar-auto-card-price">@auto.PrecioFormateado</div>
                                    </div>
                                    
                                    <!-- Botón de Favoritos -->
                                    <button class="explorar-favorite-btn favorite-btn" 
                                            data-auto-id="@auto.Id" 
                                            data-email-usuario="@(User.Identity?.IsAuthenticated == true ? User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value ?? User.FindFirst("Email")?.Value : "")"
                                            title="Agregar a favoritos"
                                            type="button"
                                            onclick="event.preventDefault(); event.stopPropagation();">
                                        <img src="https://autoclickstorage.blob.core.windows.net/uploads/Component%20183.png" 
                                             alt="Favorito" />
                                    </button>
                                </div>
                                
                                <div class="explorar-auto-card-details">
                                    <div class="explorar-auto-card-km">@auto.KilometrajeFormateado</div>
                                    <div class="explorar-auto-card-cuota">Est. @auto.CuotaMensualEstimada</div>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>

            <!-- Advertisement Banners -->
            <div style="margin-bottom: 24px;">
                @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "explorar-banner-1" })
            </div>

            @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "explorar-banner-2" })

            <!-- Pagination -->
            <nav class="explorar-pagination" aria-label="Paginación de autos">
                <div class="pagination-container">
                    <!-- Previous Button -->
                    <a href="@Url.Page("/Explorar", new { page = Model.CurrentPage - 1, sortBy = Model.SortBy })" 
                       class="pagination-arrow @(Model.CurrentPage <= 1 ? "disabled" : "")">
                        <svg width="17" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor"/>
                        </svg>
                    </a>

                    <!-- Page Numbers -->
                    @for (int i = 1; i <= Math.Min(5, Model.TotalPages); i++)
                    {
                        <a href="@Url.Page("/Explorar", new { page = i, sortBy = Model.SortBy })" 
                           class="pagination-number @(Model.CurrentPage == i ? "active" : "")">
                            @i
                        </a>
                    }

                    @if (Model.TotalPages > 5)
                    {
                        @if (Model.TotalPages > 6)
                        {
                            <span class="pagination-ellipsis">…</span>
                        }
                        
                        <a href="@Url.Page("/Explorar", new { page = Model.TotalPages, sortBy = Model.SortBy })" 
                           class="pagination-number @(Model.CurrentPage == Model.TotalPages ? "active" : "")">
                            584
                        </a>
                    }

                    <!-- Next Button -->
                    <a href="@Url.Page("/Explorar", new { page = Model.CurrentPage + 1, sortBy = Model.SortBy })" 
                       class="pagination-arrow @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")">
                        <svg width="17" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" fill="currentColor"/>
                        </svg>
                    </a>
                </div>
            </nav>
        </main>
    </div>
</div>

<!-- Footer -->
<script src="~/js/favoritos.js"></script>
<script>
function changeExplorarSorting(sortBy) {
    const url = new URL(window.location);
    url.searchParams.set('sortBy', sortBy);
    url.searchParams.set('page', '1');
    window.location.href = url.toString();
}
</script>



