@page "/guardados"
@model GuardadosModel
@{
    ViewData["Title"] = "Autos Guardados - AutoClick.cr";
}

<!-- Page Content -->
<div class="content-width">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb-nav-guardados">
        <a asp-page="/Index" class="breadcrumb-link">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Autos guardados</span>
    </nav>

    <!-- Page Header -->
    <div class="guardados-header">
        <h1 class="guardados-title">Autos guardados</h1>
        <div class="sort-dropdown">
            <select id="sortSelect" class="guardados-sort-select" onchange="changeSorting(this.value)">
                <option value="recent" selected="@(Model.SortBy == "recent")">Ordenar por: Más recientes</option>
                <option value="price-asc" selected="@(Model.SortBy == "price-asc")">Ordenar por: Precio menor a mayor</option>
                <option value="price-desc" selected="@(Model.SortBy == "price-desc")">Ordenar por: Precio mayor a menor</option>
                <option value="year" selected="@(Model.SortBy == "year")">Ordenar por: Año más nuevo</option>
            </select>
        </div>
    </div>

    <!-- Cars Grid - 3 Columns as shown in Figma -->
    <div class="guardados-grid">
        @foreach (var auto in Model.SavedAutos)
        {
            <a asp-page="/Producto" asp-route-id="@auto.Id" class="simple-auto-tile">
                <!-- Car Image -->
                <div class="simple-auto-tile-image">
                    <img src="@auto.ImagenPrincipal" alt="@auto.NombreCompleto" />

                    <!-- Botón de Favoritos -->
                    <button class="favorite-btn" 
                            data-auto-id="@auto.Id" 
                            data-email-usuario="@(User.Identity?.IsAuthenticated == true ? User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value ?? User.FindFirst("Email")?.Value : "")"
                            title="Agregar a favoritos"
                            type="button">
                        <img src="https://autoclickstorage.blob.core.windows.net/uploads/Component%20183.png" 
                             alt="Favorito" />
                    </button>
                </div>

                <!-- Car Info -->
                <div class="simple-auto-tile-info">
                    <div class="simple-auto-tile-title">@auto.NombreCompleto</div>
                    <div class="simple-auto-tile-price">@auto.PrecioEnCRC</div>
                </div>
            </a>
        }

        <!-- Advertisement Slot (as shown in Figma) -->
        @if (Model.SavedAutos.Count >= 7)
        {
            @await Component.InvokeAsync("CarruselPublicidad", new { formato = "cuadrado", seccion = "guardados-grid" })
        }
    </div>

    <!-- Pagination -->
    <nav class="guardados-pagination" aria-label="Paginación de autos guardados">
        <div class="pagination-container">
            <!-- Previous Button -->
            <a href="@Url.Page("/Guardados", new { page = Model.CurrentPage - 1, sortBy = Model.SortBy })" 
               class="pagination-arrow @(Model.CurrentPage <= 1 ? "disabled" : "")">
                <svg width="17" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor"/>
                </svg>
            </a>

            <!-- Page Numbers -->
            @for (int i = 1; i <= Math.Min(5, Model.TotalPages); i++)
            {
                <a href="@Url.Page("/Guardados", new { page = i, sortBy = Model.SortBy })" 
                   class="pagination-number @(Model.CurrentPage == i ? "active" : "")">
                    @i
                </a>
            }

            @if (Model.TotalPages > 5)
            {
                @if (Model.TotalPages > 6)
                {
                    <span class="pagination-ellipsis">…</span>
                }
                
                <a href="@Url.Page("/Guardados", new { page = Model.TotalPages, sortBy = Model.SortBy })" 
                   class="pagination-number @(Model.CurrentPage == Model.TotalPages ? "active" : "")">
                    @Model.TotalPages
                </a>
            }

            <!-- Next Button -->
            <a href="@Url.Page("/Guardados", new { page = Model.CurrentPage + 1, sortBy = Model.SortBy })" 
               class="pagination-arrow @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")">
                <svg width="17" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" fill="currentColor"/>
                </svg>
            </a>
        </div>
    </nav>

    <!-- Large Advertisement Banner -->
    @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "guardados-footer" })
</div>

<!-- Footer -->
<script>
function changeSorting(sortBy) {
    const currentPage = @Model.CurrentPage;
    const url = `@Url.Page("/Guardados")?page=1&sortBy=${sortBy}`;
    window.location.href = url;
}
</script>



