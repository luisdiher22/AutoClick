@page
@model AutoClick.Pages.MisAnunciosModel
@{
    ViewData["Title"] = "Mis anuncios - AutoClick.cr";
}

@section Styles {
    <link rel="stylesheet" href="~/css/mis-anuncios.css" />
}

@await Html.PartialAsync("_Header")

<div class="page-wrapper">
    <div class="mis-anuncios-container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="/" class="breadcrumb-item">Inicio</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Mis anuncios</span>
        </nav>

            <div class="content-wrapper">
            <!-- Sidebar Filters -->
            <aside class="sidebar">
                <div class="filter-panel">
                    <h2 class="filter-title">Filtrar mis anuncios</h2>
                    
                    <form method="get" class="filters-form">
                        <!-- Provincia -->
                        <div class="filter-group">
                            <label for="provincia">Provincia</label>
                            <select id="provincia" name="provincia" asp-for="Provincia">
                                <option value="">Todas las provincias</option>
                                <option value="San José">San José</option>
                                <option value="Alajuela">Alajuela</option>
                                <option value="Cartago">Cartago</option>
                                <option value="Heredia">Heredia</option>
                                <option value="Guanacaste">Guanacaste</option>
                                <option value="Puntarenas">Puntarenas</option>
                                <option value="Limón">Limón</option>
                            </select>
                        </div>

                        <!-- Cantón -->
                        <div class="filter-group">
                            <label for="canton">Cantón</label>
                            <select id="canton" name="canton" asp-for="Canton">
                                <option value="">Todos los cantones</option>
                            </select>
                        </div>

                        <!-- Marca -->
                        <div class="filter-group">
                            <label for="marca">Marca</label>
                            <select id="marca" name="marca" asp-for="Marca">
                                <option value="">Todas las marcas</option>
                                <option value="Toyota">Toyota</option>
                                <option value="Honda">Honda</option>
                                <option value="Nissan">Nissan</option>
                                <option value="Hyundai">Hyundai</option>
                                <option value="Mazda">Mazda</option>
                                <option value="BMW">BMW</option>
                                <option value="Mercedes-Benz">Mercedes-Benz</option>
                                <option value="Audi">Audi</option>
                            </select>
                        </div>

                        <!-- Modelo -->
                        <div class="filter-group">
                            <label for="modelo">Modelo</label>
                            <select id="modelo" name="modelo" asp-for="Modelo">
                                <option value="">Todos los modelos</option>
                            </select>
                        </div>

                        <!-- Rango de Precio -->
                        <div class="filter-group">
                            <label>Rango de precio</label>
                            <div class="price-range">
                                <div class="price-input">
                                    <label for="precioMin">Min</label>
                                    <input type="number" id="precioMin" name="precioMin" asp-for="PrecioMin" placeholder="$" />
                                </div>
                                <span class="range-separator">hasta</span>
                                <div class="price-input">
                                    <label for="precioMax">Max</label>
                                    <input type="number" id="precioMax" name="precioMax" asp-for="PrecioMax" placeholder="$" />
                                </div>
                            </div>
                        </div>

                        <!-- Kilometraje -->
                        <div class="filter-group">
                            <label>Kilometraje</label>
                            <div class="range-inputs">
                                <div class="range-input">
                                    <label for="kmMin">Min</label>
                                    <input type="number" id="kmMin" name="kmMin" asp-for="KilometrajeMin" />
                                </div>
                                <span class="range-separator">hasta</span>
                                <div class="range-input">
                                    <label for="kmMax">Max</label>
                                    <input type="number" id="kmMax" name="kmMax" asp-for="KilometrajeMax" />
                                </div>
                            </div>
                        </div>

                        <!-- Año -->
                        <div class="filter-group">
                            <label>Año</label>
                            <div class="range-inputs">
                                <div class="range-input">
                                    <label for="añoMin">Min</label>
                                    <input type="number" id="añoMin" name="añoMin" asp-for="AñoMin" />
                                </div>
                                <span class="range-separator">hasta</span>
                                <div class="range-input">
                                    <label for="añoMax">Max</label>
                                    <input type="number" id="añoMax" name="añoMax" asp-for="AñoMax" />
                                </div>
                            </div>
                        </div>

                        <!-- Filtros adicionales -->
                        <div class="additional-filters">
                            <div class="filter-dropdown">
                                <select name="carroceria" asp-for="Carroceria">
                                    <option value="">Carrocería</option>
                                    <option value="Sedán">Sedán</option>
                                    <option value="SUV">SUV</option>
                                    <option value="Hatchback">Hatchback</option>
                                    <option value="Pickup">Pickup</option>
                                    <option value="Convertible">Convertible</option>
                                    <option value="Coupé">Coupé</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="combustible" asp-for="Combustible">
                                    <option value="">Combustible/Propulsión</option>
                                    <option value="Gasolina">Gasolina</option>
                                    <option value="Diésel">Diésel</option>
                                    <option value="Híbrido">Híbrido</option>
                                    <option value="Eléctrico">Eléctrico</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="traccion" asp-for="Traccion">
                                    <option value="">Tracción</option>
                                    <option value="Delantera">Delantera</option>
                                    <option value="Trasera">Trasera</option>
                                    <option value="4x4">4x4</option>
                                    <option value="AWD">AWD</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="tipoVendedor" asp-for="TipoVendedor">
                                    <option value="">Tipo de vendedor</option>
                                    <option value="Particular">Particular</option>
                                    <option value="Concesionario">Concesionario</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="condicion" asp-for="Condicion">
                                    <option value="">Condición</option>
                                    <option value="Nuevo">Nuevo</option>
                                    <option value="Usado">Usado</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="transmision" asp-for="Transmision">
                                    <option value="">Transmisión</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Automática">Automática</option>
                                    <option value="CVT">CVT</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="pasajeros" asp-for="Pasajeros">
                                    <option value="">Pasajeros</option>
                                    <option value="2">2</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="7">7</option>
                                    <option value="8+">8+</option>
                                </select>
                            </div>

                            <div class="filter-dropdown">
                                <select name="extras" asp-for="Extras">
                                    <option value="">Extras</option>
                                    <option value="Aire acondicionado">Aire acondicionado</option>
                                    <option value="GPS">GPS</option>
                                    <option value="Cámara trasera">Cámara trasera</option>
                                    <option value="Asientos de cuero">Asientos de cuero</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="apply-filters-btn">Aplicar Filtros</button>
                    </form>
                </div>                <!-- Advertisement Placeholder -->
                <div class="sidebar-ad">
                    @await Component.InvokeAsync("CarruselPublicidad", new { formato = "cuadrado", seccion = "mis-anuncios-sidebar" })
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Page Title and Sort Options -->
                <div class="header-section">
                    <h1 class="page-title">Mis anuncios</h1>
                    
                    <div class="sort-dropdown">
                        <select name="ordenarPor" asp-for="OrdenarPor" onchange="this.form.submit()">
                            <option value="recientes">Ordenar por: Más recientes</option>
                            <option value="antiguos">Más antiguos</option>
                            <option value="precio-asc">Precio: Menor a mayor</option>
                            <option value="precio-desc">Precio: Mayor a menor</option>
                            <option value="kilometraje">Menor kilometraje</option>
                        </select>
                    </div>
                </div>

                <!-- Listings Grid -->
                <div class="listings-grid">
                    @if (Model.Anuncios != null && Model.Anuncios.Any())
                    {
                        @foreach (var anuncio in Model.Anuncios)
                        {
                            <div class="listing-card" data-listing-id="@anuncio.Id" onclick="window.location.href='@Url.Page("/Producto", new { id = anuncio.Id })'">
                                <div class="listing-image">
                                    <img src="@(anuncio.ImagenPrincipal ?? "https://via.placeholder.com/416x262")" alt="@anuncio.Titulo" />
                                    @if (anuncio.EsDestacado)
                                    {
                                        <span class="destacado-badge">Destacado</span>
                                    }
                                    <div class="listing-overlay">
                                        <span class="dias-restantes">@anuncio.DiasRestantes días restantes</span>
                                    </div>
                                    <div class="listing-logo">
                                        <img src="/images/logo-square.png" alt="AutoClick Logo" onerror="this.style.display='none'" />
                                    </div>
                                </div>
                                
                                <div class="listing-info">
                                    <h3 class="listing-title">@anuncio.Titulo</h3>
                                    <div class="listing-price">₡@anuncio.Precio.ToString("N0")</div>
                                    
                                    <div class="listing-meta">
                                        <div class="listing-stats">
                                            <span class="stats-item">
                                                <svg class="icon-eye" width="24" height="14" viewBox="0 0 24 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 0.5C6.545 0.5 1.909 3.85 0 8.583C1.909 13.316 6.545 16.666 12 16.666C17.455 16.666 22.091 13.316 24 8.583C22.091 3.85 17.455 0.5 12 0.5ZM12 14.166C8.364 14.166 5.182 12.066 3.818 8.75C5.182 5.434 8.364 3.334 12 3.334C15.636 3.334 18.818 5.434 20.182 8.75C18.818 12.066 15.636 14.166 12 14.166ZM12 5.417C9.818 5.417 8.045 7.05 8.045 9.067C8.045 11.084 9.818 12.717 12 12.717C14.182 12.717 15.955 11.084 15.955 9.067C15.955 7.05 14.182 5.417 12 5.417ZM12 11.417C10.636 11.417 9.545 10.384 9.545 9.067C9.545 7.75 10.636 6.717 12 6.717C13.364 6.717 14.455 7.75 14.455 9.067C14.455 10.384 13.364 11.417 12 11.417Z" fill="white"/>
                                                </svg>
                                                @anuncio.Vistas
                                            </span>
                                            <span class="stats-item">
                                                <svg class="icon-heart" width="15" height="13" viewBox="0 0 15 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M13.227 1.619C11.827 0.499 9.867 0.499 8.607 1.619L7.627 2.499L6.647 1.619C5.387 0.505 3.427 0.505 2.027 1.619C0.837 2.599 0.417 4.069 0.767 5.469C1.117 6.799 2.027 7.989 3.287 9.109L7.627 12.999L11.967 9.109C13.227 7.989 14.137 6.799 14.487 5.469C14.837 4.069 14.417 2.599 13.227 1.619Z" fill="white"/>
                                                </svg>
                                                @anuncio.MeGusta
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="listing-date">Publicado el @anuncio.FechaPublicacion.ToString("dd/MM/yy")</div>
                                    
                                    <div class="listing-status-container">
                                        <span class="listing-status @anuncio.Estado.ToString().ToLower()">
                                            @anuncio.Estado
                                        </span>
                                    </div>
                                    
                                    <div class="listing-actions" onclick="event.stopPropagation()">
                                        <button class="action-btn edit-btn" title="Editar anuncio" onclick="window.location.href='/AnunciarMiAuto?edit=@anuncio.Id'">
                                            <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M19.5 8.5L17.5 6.5M7 19H9L18.5 9.5C19.3284 8.67157 19.3284 7.32843 18.5 6.5C17.6716 5.67157 16.3284 5.67157 15.5 6.5L6 16V19H7Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                        <button class="action-btn delete-btn" title="Eliminar anuncio" onclick="confirmDeleteListing(this, '@anuncio.Id', '@anuncio.Titulo')">
                                            <svg width="17" height="19" viewBox="0 0 17 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M1.5 4.75H15.5M6.75 8.5V15.25M10.25 8.5V15.25M2.375 4.75L3.25 16.563C3.25 17.597 4.091 18.438 5.125 18.438H11.875C12.909 18.438 13.75 17.597 13.75 16.563L14.625 4.75M6.75 4.75V2.875C6.75 2.358 7.17 1.937 7.688 1.937H10.313C10.83 1.937 11.25 2.358 11.25 2.875V4.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-listings">
                            <h3>No tienes anuncios publicados</h3>
                            <p>¡Comienza a vender tu vehículo ahora!</p>
                            <a href="/anunciar-mi-auto" class="btn-primary">Publicar Anuncio</a>
                        </div>
                    }
                </div>

                <!-- Pagination -->
                @if (Model.TotalPaginas > 1)
                {
                    <div class="pagination">
                        @if (Model.PaginaActual > 1)
                        {
                            <a href="?pagina=@(Model.PaginaActual - 1)" class="pagination-btn prev">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M25 30L15 20L25 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        }

                        @for (int i = 1; i <= Math.Min(5, Model.TotalPaginas); i++)
                        {
                            <a href="?pagina=@i" class="pagination-number @(i == Model.PaginaActual ? "active" : "")">@i</a>
                        }

                        @if (Model.TotalPaginas > 5)
                        {
                            <span class="pagination-ellipsis">…</span>
                            <a href="?pagina=@Model.TotalPaginas" class="pagination-number">@Model.TotalPaginas</a>
                        }

                        @if (Model.PaginaActual < Model.TotalPaginas)
                        {
                            <a href="?pagina=@(Model.PaginaActual + 1)" class="pagination-btn next">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M15 10L25 20L15 30" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        }
                    </div>
                }

                <!-- Bottom Advertisement -->
                <div class="bottom-ad">
                    @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "mis-anuncios-footer" })
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
</div>

@section Scripts {
    <form style="display: none;">
        @Html.AntiForgeryToken()
    </form>
    <script src="~/js/mis-anuncios.js"></script>
}

