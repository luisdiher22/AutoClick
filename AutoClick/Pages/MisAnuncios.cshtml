@page
@model AutoClick.Pages.MisAnunciosModel
@{
    ViewData["Title"] = "Mis anuncios - AutoClick.cr";
}

@section Styles {
    <link rel="stylesheet" href="~/css/mis-anuncios.css" />
    <link rel="stylesheet" href="~/css/mis-anuncios-responsive.css" />
}

<!-- Dark Theme Page Container -->
<div class="busqueda-avanzada-page">
    <div class="busqueda-container">
        <!-- Breadcrumb -->
        <nav class="busqueda-breadcrumb">
            <a asp-page="/Index" class="breadcrumb-link">Inicio</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Mis anuncios</span>
        </nav>

        <div class="busqueda-content">
            <!-- Sidebar Filters -->
            <aside class="busqueda-sidebar">
                <div class="busqueda-filters-container">
                    <div class="busqueda-filters-section">
                        <h3 class="busqueda-filters-title">Filtrar mis anuncios</h3>
                    
                        <!-- Applied Filters Tags -->
                        @if (Model.AppliedFilters != null && Model.AppliedFilters.Any())
                        {
                            <div class="applied-filters-tags">
                                @foreach (var filter in Model.AppliedFilters)
                                {
                                    <div class="filter-tag">
                                        <span>@filter</span>
                                        <button class="remove-filter-btn" onclick="removeFilter('@filter')" title="Eliminar filtro">×</button>
                                    </div>
                                }
                            </div>
                            
                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />
                        }

                        <form method="get" class="busqueda-filters-form" id="desktopFilterForm">
                            <input type="hidden" name="page" value="1" />
                            <input type="hidden" name="sortBy" value="@Model.OrdenarPor" />

                            <!-- Provincia -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Provincia</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="provincia" name="provincia" class="busqueda-filter-select" asp-for="Provincia" onchange="autoSubmitFilters()">
                                        <option value="">Todas las provincias</option>
                                        <option value="San José">San José</option>
                                        <option value="Alajuela">Alajuela</option>
                                        <option value="Cartago">Cartago</option>
                                        <option value="Heredia">Heredia</option>
                                        <option value="Guanacaste">Guanacaste</option>
                                        <option value="Puntarenas">Puntarenas</option>
                                        <option value="Limón">Limón</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Cantón -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Cantón</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="canton" name="canton" class="busqueda-filter-select" asp-for="Canton" onchange="autoSubmitFilters()">
                                        <option value="">Todos los cantones</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />

                            <!-- Marca -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Marca</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="marca" name="marca" class="busqueda-filter-select" asp-for="Marca" onchange="autoSubmitFilters()">
                                        <option value="">Todas las marcas</option>
                                <option value="Toyota">Toyota</option>
                                <option value="Honda">Honda</option>
                                <option value="Nissan">Nissan</option>
                                <option value="Hyundai">Hyundai</option>
                                <option value="Mazda">Mazda</option>
                                <option value="BMW">BMW</option>
                                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                                        <option value="Audi">Audi</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Modelo -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Modelo</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="modelo" name="modelo" class="busqueda-filter-select" asp-for="Modelo" onchange="autoSubmitFilters()">
                                        <option value="">Todos los modelos</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />

                            <!-- Rango de precio -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Rango de precio</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" id="precioMin" name="precioMin" asp-for="PrecioMin" placeholder="$" class="busqueda-price-field" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" id="precioMax" name="precioMax" asp-for="PrecioMax" placeholder="$" class="busqueda-price-field" />
                                    </div>
                                </div>
                            </div>

                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />

                            <!-- Kilometraje -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Kilometraje</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" id="kmMin" name="kmMin" asp-for="KilometrajeMin" class="busqueda-price-field" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" id="kmMax" name="kmMax" asp-for="KilometrajeMax" class="busqueda-price-field" />
                                    </div>
                                </div>
                            </div>

                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />

                            <!-- Año -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Año</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" id="añoMin" name="añoMin" asp-for="AñoMin" class="busqueda-price-field" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" id="añoMax" name="añoMax" asp-for="AñoMax" class="busqueda-price-field" />
                                    </div>
                                </div>
                            </div>

                            <!-- Línea divisoria -->
                            <hr class="filter-divider" />

                            <!-- Carrocería -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Carrocería</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="carroceria" class="busqueda-filter-select" asp-for="Carroceria" onchange="autoSubmitFilters()">
                                        <option value="">Todas las carrocerías</option>
                                        <option value="Sedán">Sedán</option>
                                        <option value="SUV">SUV</option>
                                        <option value="Hatchback">Hatchback</option>
                                        <option value="Pickup">Pickup</option>
                                        <option value="Convertible">Convertible</option>
                                        <option value="Coupé">Coupé</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Combustible -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Combustible/Propulsión</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="combustible" class="busqueda-filter-select" asp-for="Combustible" onchange="autoSubmitFilters()">
                                        <option value="">Todos los tipos</option>
                                        <option value="Gasolina">Gasolina</option>
                                        <option value="Diésel">Diésel</option>
                                        <option value="Híbrido">Híbrido</option>
                                        <option value="Eléctrico">Eléctrico</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Tracción -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Tracción</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="traccion" class="busqueda-filter-select" asp-for="Traccion" onchange="autoSubmitFilters()">
                                        <option value="">Todas las tracciones</option>
                                        <option value="Delantera">Delantera</option>
                                        <option value="Trasera">Trasera</option>
                                        <option value="4x4">4x4</option>
                                        <option value="AWD">AWD</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Tipo de Vendedor -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Tipo de vendedor</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="tipoVendedor" class="busqueda-filter-select" asp-for="TipoVendedor" onchange="autoSubmitFilters()">
                                        <option value="">Todos</option>
                                        <option value="Particular">Particular</option>
                                        <option value="Concesionario">Concesionario</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Condición -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Condición</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="condicion" class="busqueda-filter-select" asp-for="Condicion" onchange="autoSubmitFilters()">
                                        <option value="">Todas</option>
                                        <option value="Nuevo">Nuevo</option>
                                        <option value="Usado">Usado</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Transmisión -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Transmisión</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="transmision" class="busqueda-filter-select" asp-for="Transmision" onchange="autoSubmitFilters()">
                                        <option value="">Todas</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Automática">Automática</option>
                                        <option value="CVT">CVT</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Pasajeros -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Pasajeros</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="pasajeros" class="busqueda-filter-select" asp-for="Pasajeros" onchange="autoSubmitFilters()">
                                        <option value="">Todos</option>
                                        <option value="2">2</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="7">7</option>
                                        <option value="8+">8+</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Extras -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Extras</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="extras" class="busqueda-filter-select" asp-for="Extras" onchange="autoSubmitFilters()">
                                        <option value="">Todos</option>
                                        <option value="Aire acondicionado">Aire acondicionado</option>
                                        <option value="GPS">GPS</option>
                                        <option value="Cámara trasera">Cámara trasera</option>
                                        <option value="Asientos de cuero">Asientos de cuero</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Advertisement Placeholder -->
                @await Component.InvokeAsync("CarruselPublicidad", new { formato = "cuadrado", seccion = "mis-anuncios-sidebar" })
            </aside>

            <!-- Main Content -->
            <main class="busqueda-main">
                <!-- Sort Dropdown -->
                <div class="busqueda-sort-header">
                    <!-- Mobile/Tablet Filter Button -->
                    <button class="busqueda-filter-btn-mobile" onclick="openFilterModal()">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                            <g stroke="currentColor" stroke-width="1.6" stroke-linecap="round">
                                <path d="M4.5 3V15"/>
                                <circle cx="4.5" cy="6.5" r="1.6" fill="currentColor"/>
                                <path d="M9 3V15"/>
                                <circle cx="9" cy="11.5" r="1.6" fill="currentColor"/>
                                <path d="M13.5 3V15"/>
                                <circle cx="13.5" cy="8.5" r="1.6" fill="currentColor"/>
                            </g>
                        </svg>
                        Filtros
                    </button>

                    <div class="busqueda-sort-wrapper">
                        <select class="busqueda-sort-select" onchange="changeMisAnunciosSorting(this.value)">
                            <option value="recent" selected="@(Model.OrdenarPor == "recent" || string.IsNullOrEmpty(Model.OrdenarPor))">Ordenar por: Más recientes</option>
                            <option value="price-asc" selected="@(Model.OrdenarPor == "price-asc")">Ordenar por: Precio menor a mayor</option>
                            <option value="price-desc" selected="@(Model.OrdenarPor == "price-desc")">Ordenar por: Precio mayor a menor</option>
                            <option value="year" selected="@(Model.OrdenarPor == "year")">Ordenar por: Año más nuevo</option>
                        </select>
                    </div>
                </div>

                <!-- Listings Grid - 2 Columns -->
                <div class="busqueda-cars-grid">
                    @if (Model.Anuncios != null && Model.Anuncios.Any())
                    {
                        @foreach (var anuncio in Model.Anuncios)
                        {
                            <div class="listing-card" data-listing-id="@anuncio.Id" onclick="window.location.href='@Url.Page("/Producto", new { id = anuncio.Id })'">
                                <div class="listing-image">
                                    <img src="@(anuncio.ImagenPrincipal ?? "https://via.placeholder.com/416x262")" alt="@anuncio.Titulo" />
                                    @if (anuncio.EsDestacado)
                                    {
                                        <span class="destacado-badge">Destacado</span>
                                    }
                                    <div class="listing-overlay">
                                        <span class="dias-restantes">@anuncio.DiasRestantes días restantes</span>
                                    </div>
                                    <div class="listing-logo">
                                        <img src="/images/logo-square.png" alt="AutoClick Logo" onerror="this.style.display='none'" />
                                    </div>
                                </div>
                                
                                <div class="listing-info">
                                    <h3 class="listing-title">@anuncio.Titulo</h3>
                                    <div class="listing-price">₡@anuncio.Precio.ToString("N0")</div>
                                    
                                    <div class="listing-meta">
                                        <div class="listing-stats">
                                            <span class="stats-item">
                                                <svg class="icon-eye" width="24" height="14" viewBox="0 0 24 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 0.5C6.545 0.5 1.909 3.85 0 8.583C1.909 13.316 6.545 16.666 12 16.666C17.455 16.666 22.091 13.316 24 8.583C22.091 3.85 17.455 0.5 12 0.5ZM12 14.166C8.364 14.166 5.182 12.066 3.818 8.75C5.182 5.434 8.364 3.334 12 3.334C15.636 3.334 18.818 5.434 20.182 8.75C18.818 12.066 15.636 14.166 12 14.166ZM12 5.417C9.818 5.417 8.045 7.05 8.045 9.067C8.045 11.084 9.818 12.717 12 12.717C14.182 12.717 15.955 11.084 15.955 9.067C15.955 7.05 14.182 5.417 12 5.417ZM12 11.417C10.636 11.417 9.545 10.384 9.545 9.067C9.545 7.75 10.636 6.717 12 6.717C13.364 6.717 14.455 7.75 14.455 9.067C14.455 10.384 13.364 11.417 12 11.417Z" fill="white"/>
                                                </svg>
                                                @anuncio.Vistas
                                            </span>
                                            <span class="stats-item">
                                                <svg class="icon-heart" width="15" height="13" viewBox="0 0 15 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M13.227 1.619C11.827 0.499 9.867 0.499 8.607 1.619L7.627 2.499L6.647 1.619C5.387 0.505 3.427 0.505 2.027 1.619C0.837 2.599 0.417 4.069 0.767 5.469C1.117 6.799 2.027 7.989 3.287 9.109L7.627 12.999L11.967 9.109C13.227 7.989 14.137 6.799 14.487 5.469C14.837 4.069 14.417 2.599 13.227 1.619Z" fill="white"/>
                                                </svg>
                                                @anuncio.MeGusta
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="listing-date">Publicado el @anuncio.FechaPublicacion.ToString("dd/MM/yy")</div>
                                    
                                    <div class="listing-status-container">
                                        <span class="listing-status @anuncio.Estado.ToString().ToLower()">
                                            @anuncio.Estado
                                        </span>
                                    </div>
                                    
                                    <div class="listing-actions" onclick="event.stopPropagation()">
                                        <button class="action-btn edit-btn" title="Editar anuncio" onclick="window.location.href='/AnunciarMiAuto?edit=@anuncio.Id'">
                                            <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M19.5 8.5L17.5 6.5M7 19H9L18.5 9.5C19.3284 8.67157 19.3284 7.32843 18.5 6.5C17.6716 5.67157 16.3284 5.67157 15.5 6.5L6 16V19H7Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                        <button class="action-btn delete-btn" title="Eliminar anuncio" onclick="confirmDeleteListing(this, '@anuncio.Id', '@anuncio.Titulo')">
                                            <svg width="17" height="19" viewBox="0 0 17 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M1.5 4.75H15.5M6.75 8.5V15.25M10.25 8.5V15.25M2.375 4.75L3.25 16.563C3.25 17.597 4.091 18.438 5.125 18.438H11.875C12.909 18.438 13.75 17.597 13.75 16.563L14.625 4.75M6.75 4.75V2.875C6.75 2.358 7.17 1.937 7.688 1.937H10.313C10.83 1.937 11.25 2.358 11.25 2.875V4.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-listings">
                            <h3>No tienes anuncios publicados</h3>
                            <p>¡Comienza a vender tu vehículo ahora!</p>
                            <a asp-page="/AnunciarMiAuto" class="btn-primary">Publicar Anuncio</a>
                        </div>
                    }
                </div>

                <!-- Pagination -->
                @if (Model.TotalPaginas > 1)
                {
                    <nav class="busqueda-pagination" aria-label="Paginación de anuncios">
                        <div class="pagination-container">
                            <!-- Previous Button -->
                            <a href="?pagina=@(Model.PaginaActual - 1)" 
                               class="busqueda-pagination-arrow @(Model.PaginaActual <= 1 ? "disabled" : "")">
                                <div class="pagination-arrow-icon left"></div>
                            </a>

                            <!-- Page Numbers -->
                            @for (int i = 1; i <= Math.Min(5, Model.TotalPaginas); i++)
                            {
                                <a href="?pagina=@i" 
                                   class="busqueda-pagination-number @(Model.PaginaActual == i ? "active" : "")">
                                    @i
                                </a>
                            }

                            @if (Model.TotalPaginas > 5)
                            {
                                <span class="busqueda-pagination-ellipsis">…</span>
                                
                                <a href="?pagina=@Model.TotalPaginas" 
                                   class="busqueda-pagination-number @(Model.PaginaActual == Model.TotalPaginas ? "active" : "")">
                                    @Model.TotalPaginas
                                </a>
                            }

                            <!-- Next Button -->
                            <a href="?pagina=@(Model.PaginaActual + 1)" 
                               class="busqueda-pagination-arrow @(Model.PaginaActual >= Model.TotalPaginas ? "disabled" : "")">
                                <div class="pagination-arrow-icon right"></div>
                            </a>
                        </div>
                    </nav>
                }

                <!-- Advertisement after pagination -->
                <div style="margin-top: 48px;">
                    @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "mis-anuncios-footer" })
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile/Tablet Filter Modal -->
    <div class="busqueda-filter-modal" id="filterModal">
        <div class="busqueda-filter-modal-content">
            <div class="busqueda-filter-modal-header">
                <h3 class="busqueda-filter-modal-title">Filtros de búsqueda</h3>
                <button class="busqueda-filter-modal-close" onclick="closeFilterModal()">&times;</button>
            </div>
            
            <div class="busqueda-filter-modal-body">
                <div class="busqueda-filters-container">
                    <div class="busqueda-filters-section">
                        <form method="get" class="busqueda-filters-form" id="mobileFilterForm">
                            <input type="hidden" name="page" value="1" />
                            <input type="hidden" name="sortBy" value="@Model.OrdenarPor" />

                            <!-- Same filters as desktop sidebar -->
                            <!-- Provincia -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Provincia</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="provincia-modal" name="provincia" class="busqueda-filter-select" asp-for="Provincia">
                                        <option value="">Todas las provincias</option>
                                        <option value="San José">San José</option>
                                        <option value="Alajuela">Alajuela</option>
                                        <option value="Cartago">Cartago</option>
                                        <option value="Heredia">Heredia</option>
                                        <option value="Guanacaste">Guanacaste</option>
                                        <option value="Puntarenas">Puntarenas</option>
                                        <option value="Limón">Limón</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Cantón -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Cantón</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="canton-modal" name="canton" class="busqueda-filter-select" asp-for="Canton">
                                        <option value="">Todos los cantones</option>
                                    </select>
                                </div>
                            </div>

                            <hr class="filter-divider" />

                            <!-- Marca -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Marca</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="marca-modal" name="marca" class="busqueda-filter-select" asp-for="Marca">
                                        <option value="">Todas las marcas</option>
                                        <option value="Toyota">Toyota</option>
                                        <option value="Honda">Honda</option>
                                        <option value="Nissan">Nissan</option>
                                        <option value="Hyundai">Hyundai</option>
                                        <option value="Mazda">Mazda</option>
                                        <option value="BMW">BMW</option>
                                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                                        <option value="Audi">Audi</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Modelo -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Modelo</label>
                                <div class="busqueda-select-wrapper">
                                    <select id="modelo-modal" name="modelo" class="busqueda-filter-select" asp-for="Modelo">
                                        <option value="">Todos los modelos</option>
                                    </select>
                                </div>
                            </div>

                            <hr class="filter-divider" />

                            <!-- Rango de precio -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Rango de precio</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" name="precioMin" placeholder="$" class="busqueda-price-field" asp-for="PrecioMin" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" name="precioMax" placeholder="$" class="busqueda-price-field" asp-for="PrecioMax" />
                                    </div>
                                </div>
                            </div>

                            <hr class="filter-divider" />

                            <!-- Kilometraje -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Kilometraje</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" name="kmMin" class="busqueda-price-field" asp-for="KilometrajeMin" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" name="kmMax" class="busqueda-price-field" asp-for="KilometrajeMax" />
                                    </div>
                                </div>
                            </div>

                            <hr class="filter-divider" />

                            <!-- Año -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Año</label>
                                <div class="busqueda-price-range">
                                    <div class="price-input-group">
                                        <label class="price-input-label">Min</label>
                                        <input type="number" name="añoMin" class="busqueda-price-field" asp-for="AñoMin" />
                                    </div>
                                    <span class="price-separator">hasta</span>
                                    <div class="price-input-group">
                                        <label class="price-input-label">Max</label>
                                        <input type="number" name="añoMax" class="busqueda-price-field" asp-for="AñoMax" />
                                    </div>
                                </div>
                            </div>

                            <hr class="filter-divider" />

                            <!-- Carrocería -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Carrocería</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="carroceria" class="busqueda-filter-select" asp-for="Carroceria">
                                        <option value="">Todas las carrocerías</option>
                                        <option value="Sedán">Sedán</option>
                                        <option value="SUV">SUV</option>
                                        <option value="Hatchback">Hatchback</option>
                                        <option value="Pickup">Pickup</option>
                                        <option value="Convertible">Convertible</option>
                                        <option value="Coupé">Coupé</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Combustible -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Combustible/Propulsión</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="combustible" class="busqueda-filter-select" asp-for="Combustible">
                                        <option value="">Todos los tipos</option>
                                        <option value="Gasolina">Gasolina</option>
                                        <option value="Diésel">Diésel</option>
                                        <option value="Híbrido">Híbrido</option>
                                        <option value="Eléctrico">Eléctrico</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Tracción -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Tracción</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="traccion" class="busqueda-filter-select" asp-for="Traccion">
                                        <option value="">Todas las tracciones</option>
                                        <option value="Delantera">Delantera</option>
                                        <option value="Trasera">Trasera</option>
                                        <option value="4x4">4x4</option>
                                        <option value="AWD">AWD</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Tipo de Vendedor -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Tipo de vendedor</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="tipoVendedor" class="busqueda-filter-select" asp-for="TipoVendedor">
                                        <option value="">Todos</option>
                                        <option value="Particular">Particular</option>
                                        <option value="Concesionario">Concesionario</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Condición -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Condición</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="condicion" class="busqueda-filter-select" asp-for="Condicion">
                                        <option value="">Todas</option>
                                        <option value="Nuevo">Nuevo</option>
                                        <option value="Usado">Usado</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Transmisión -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Transmisión</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="transmision" class="busqueda-filter-select" asp-for="Transmision">
                                        <option value="">Todas</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Automática">Automática</option>
                                        <option value="CVT">CVT</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Pasajeros -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Pasajeros</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="pasajeros" class="busqueda-filter-select" asp-for="Pasajeros">
                                        <option value="">Todos</option>
                                        <option value="2">2</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="7">7</option>
                                        <option value="8+">8+</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Extras -->
                            <div class="busqueda-filter-group">
                                <label class="busqueda-filter-label">Extras</label>
                                <div class="busqueda-select-wrapper">
                                    <select name="extras" class="busqueda-filter-select" asp-for="Extras">
                                        <option value="">Todos</option>
                                        <option value="Aire acondicionado">Aire acondicionado</option>
                                        <option value="GPS">GPS</option>
                                        <option value="Cámara trasera">Cámara trasera</option>
                                        <option value="Asientos de cuero">Asientos de cuero</option>
                                    </select>
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Modal Actions (Mobile/Tablet) -->
            <div class="busqueda-filter-modal-actions">
                <button type="button" class="busqueda-filter-apply-btn" onclick="document.getElementById('mobileFilterForm').submit();">Aplicar filtros</button>
                <button type="button" class="busqueda-filter-clear-btn" onclick="clearFilters()">Limpiar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <form style="display: none;">
        @Html.AntiForgeryToken()
    </form>
    <script src="~/js/mis-anuncios.js"></script>
    <script>
        // Filter Modal Functions
        function openFilterModal() {
            document.getElementById('filterModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeFilterModal() {
            document.getElementById('filterModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        // Close modal when clicking outside
        document.getElementById('filterModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeFilterModal();
            }
        });

        // Sorting function
        function changeMisAnunciosSorting(sortValue) {
            const url = new URL(window.location.href);
            url.searchParams.set('ordenarPor', sortValue);
            url.searchParams.set('pagina', '1'); // Reset to page 1 when sorting changes
            window.location.href = url.toString();
        }

        // Auto-submit filters when selection changes (for desktop sidebar)
        function autoSubmitFilters() {
            document.getElementById('desktopFilterForm').submit();
        }

        // Load cantones based on selected provincia
        function cargarCantones(provincia) {
            const cantonSelect = document.getElementById('canton');
            const cantonSelectModal = document.getElementById('canton-modal');
            
            // Clear both selects
            [cantonSelect, cantonSelectModal].forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Todos los cantones</option>';
                }
            });
            
            // Cantones by province
            const cantonesPorProvincia = {
                'San José': ['Central', 'Escazú', 'Desamparados', 'Puriscal', 'Tarrazú', 'Aserrí', 'Mora', 'Goicoechea', 'Santa Ana', 'Alajuelita', 'Coronado', 'Acosta', 'Tibás', 'Moravia', 'Montes de Oca', 'Turrubares', 'Dota', 'Curridabat', 'Pérez Zeledón', 'León Cortés'],
                'Alajuela': ['Central', 'San Ramón', 'Grecia', 'San Mateo', 'Atenas', 'Naranjo', 'Palmares', 'Poás', 'Orotina', 'San Carlos', 'Zarcero', 'Sarchí', 'Upala', 'Los Chiles', 'Guatuso'],
                'Cartago': ['Central', 'Paraíso', 'La Unión', 'Jiménez', 'Turrialba', 'Alvarado', 'Oreamuno', 'El Guarco'],
                'Heredia': ['Central', 'Barva', 'Santo Domingo', 'Santa Bárbara', 'San Rafael', 'San Isidro', 'Belén', 'Flores', 'San Pablo', 'Sarapiquí'],
                'Guanacaste': ['Liberia', 'Nicoya', 'Santa Cruz', 'Bagaces', 'Carrillo', 'Cañas', 'Abangares', 'Tilarán', 'Nandayure', 'La Cruz', 'Hojancha'],
                'Puntarenas': ['Central', 'Esparza', 'Buenos Aires', 'Montes de Oro', 'Osa', 'Quepos', 'Golfito', 'Coto Brus', 'Parrita', 'Corredores', 'Garabito'],
                'Limón': ['Central', 'Pococí', 'Siquirres', 'Talamanca', 'Matina', 'Guácimo']
            };
            
            if (cantonesPorProvincia[provincia]) {
                cantonesPorProvincia[provincia].forEach(canton => {
                    [cantonSelect, cantonSelectModal].forEach(select => {
                        if (select) {
                            const option = document.createElement('option');
                            option.value = canton;
                            option.textContent = canton;
                            select.appendChild(option);
                        }
                    });
                });
            }
        }

        // Load modelos based on selected marca
        function cargarModelos(marca) {
            const modeloSelect = document.getElementById('modelo');
            const modeloSelectModal = document.getElementById('modelo-modal');
            
            // Clear both selects
            [modeloSelect, modeloSelectModal].forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Todos los modelos</option>';
                }
            });
            
            // Models by brand
            const modelosPorMarca = {
                'Toyota': ['Corolla', 'Camry', 'Prius', 'RAV4', 'Highlander', 'Tacoma', 'Tundra', '4Runner', 'Sienna', 'Avalon', 'Land Cruiser', 'Yaris'],
                'Honda': ['Civic', 'Accord', 'CR-V', 'Pilot', 'Fit', 'HR-V', 'Passport', 'Ridgeline', 'Insight', 'Odyssey'],
                'Nissan': ['Sentra', 'Altima', 'Maxima', 'Rogue', 'Pathfinder', 'Murano', 'Frontier', 'Titan', 'Armada', 'Leaf', 'Kicks', 'Versa'],
                'Hyundai': ['Elantra', 'Sonata', 'Tucson', 'Santa Fe', 'Kona', 'Palisade', 'Accent', 'Veloster', 'Genesis', 'Ioniq'],
                'Mazda': ['Mazda3', 'Mazda6', 'CX-3', 'CX-5', 'CX-9', 'MX-5', 'CX-30', 'Mazda2', 'BT-50'],
                'BMW': ['Serie 1', 'Serie 2', 'Serie 3', 'Serie 4', 'Serie 5', 'Serie 7', 'X1', 'X3', 'X5', 'X7', 'Z4'],
                'Mercedes-Benz': ['Clase A', 'Clase C', 'Clase E', 'Clase S', 'GLA', 'GLB', 'GLC', 'GLE', 'GLS'],
                'Audi': ['A3', 'A4', 'A6', 'A8', 'Q3', 'Q5', 'Q7', 'Q8', 'TT']
            };
            
            if (modelosPorMarca[marca]) {
                modelosPorMarca[marca].forEach(modelo => {
                    [modeloSelect, modeloSelectModal].forEach(select => {
                        if (select) {
                            const option = document.createElement('option');
                            option.value = modelo;
                            option.textContent = modelo;
                            select.appendChild(option);
                        }
                    });
                });
            }
        }

        // Add event listeners to provincia and marca selects
        document.addEventListener('DOMContentLoaded', function() {
            const provinciaSelect = document.getElementById('provincia');
            const marcaSelect = document.getElementById('marca');
            const provinciaSelectModal = document.getElementById('provincia-modal');
            const marcaSelectModal = document.getElementById('marca-modal');
            
            if (provinciaSelect) {
                provinciaSelect.addEventListener('change', function() {
                    cargarCantones(this.value);
                });
                // Load cantones if provincia is already selected
                if (provinciaSelect.value) {
                    cargarCantones(provinciaSelect.value);
                }
            }
            
            if (marcaSelect) {
                marcaSelect.addEventListener('change', function() {
                    cargarModelos(this.value);
                });
                // Load modelos if marca is already selected
                if (marcaSelect.value) {
                    cargarModelos(marcaSelect.value);
                }
            }

            if (provinciaSelectModal) {
                provinciaSelectModal.addEventListener('change', function() {
                    cargarCantones(this.value);
                });
            }
            
            if (marcaSelectModal) {
                marcaSelectModal.addEventListener('change', function() {
                    cargarModelos(this.value);
                });
            }
        });

        // Clear all filters
        function clearFilters() {
            const url = new URL(window.location.origin + window.location.pathname);
            url.searchParams.set('page', '1');
            url.searchParams.set('ordenarPor', '@Model.OrdenarPor');
            window.location.href = url.toString();
        }

        // Remove filter function
        function removeFilter(filterValue) {
            const url = new URL(window.location);
            
            // Check which parameter to remove based on the filter value
            // Match patterns for different filter types
            if (filterValue.includes('₡')) {
                // Price range filter
                url.searchParams.delete('precioMin');
                url.searchParams.delete('precioMax');
            } else if (filterValue.includes('km')) {
                // Kilometrage filter
                url.searchParams.delete('kmMin');
                url.searchParams.delete('kmMax');
            } else if (/^\d{4}/.test(filterValue)) {
                // Year filter (starts with 4 digits)
                url.searchParams.delete('añoMin');
                url.searchParams.delete('añoMax');
            } else {
                // Try to find the parameter by comparing values
                const params = ['provincia', 'canton', 'marca', 'modelo', 'carroceria', 'combustible', 
                              'traccion', 'tipoVendedor', 'condicion', 'transmision', 'pasajeros', 'extras'];
                
                params.forEach(param => {
                    const currentValue = url.searchParams.get(param);
                    if (currentValue && currentValue === filterValue) {
                        url.searchParams.delete(param);
                        // Also clear dependent fields
                        if (param === 'marca') url.searchParams.delete('modelo');
                        if (param === 'provincia') url.searchParams.delete('canton');
                    }
                });
            }
            
            url.searchParams.set('page', '1');
            window.location.href = url.toString();
        }
    </script>
}

