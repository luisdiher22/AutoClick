@page "/recien-vistos"
@model RecienVistosModel
@{
    ViewData["Title"] = "Recién Vistos - AutoClick.cr";
}

<div style="width: 100%; min-height: 100vh; position: relative; background: #02081C; overflow: hidden">
    <!-- Breadcrumb Navigation -->
    <div style="left: 32px; top: 40px; position: absolute; justify-content: flex-start; align-items: center; gap: 8px; display: inline-flex">
        <div data-estado="Default" style="height: 40px; justify-content: center; align-items: center; gap: 8px; display: flex">
            <div style="justify-content: center; align-items: center; gap: 8px; display: flex">
                <a asp-page="/Index" style="text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 16px; font-family: Montserrat; font-weight: 400; word-wrap: break-word; text-decoration: none;">Inicio</a>
            </div>
        </div>
        <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 16px; font-family: Montserrat; font-weight: 400; word-wrap: break-word">/</div>
        <div data-estado="Default" style="height: 40px; justify-content: center; align-items: center; gap: 8px; display: flex">
            <div style="justify-content: center; align-items: center; gap: 8px; display: flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 16px; font-family: Montserrat; font-weight: 400; word-wrap: break-word">Recién vistos</div>
            </div>
        </div>
    </div>

    <!-- Page Title -->
    <div style="left: 32px; top: 128px; position: absolute; text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 24px; font-family: Montserrat; font-weight: 700; word-wrap: break-word">Autos recién vistos</div>

    <!-- Sort Controls -->
    <div data-property-1="Frame 144" style="padding-left: 4px; padding-right: 4px; right: 32px; top: 105px; position: absolute; overflow: hidden; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
        <div style="align-self: stretch; padding: 8px; border-radius: 4px; justify-content: flex-start; align-items: center; gap: 8px; display: inline-flex">
            <div data-estado="Default" style="height: 40px; justify-content: center; align-items: center; gap: 8px; display: flex">
                <div style="justify-content: center; align-items: center; gap: 8px; display: flex">
                    <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 16px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">Ordenar por: Más recientes</div>
                </div>
            </div>
            <div style="width: 16px; height: 8px; background: white"></div>
        </div>
    </div>

    <!-- Cars Grid -->
    @{
        int totalCars = Model.RecentlyViewedAutos.Count();
        int columns = 4; // Cambiado de 3 a 4 para pantallas de 1728px o superiores
        int rows = (int)Math.Ceiling((double)totalCars / columns);
        int currentIndex = 0;
    }

    @if (totalCars > 0)
    {
        @foreach (var auto in Model.RecentlyViewedAutos)
        {
            int row = currentIndex / columns;
            int col = currentIndex % columns;
            int topPosition = 169 + (row * 312); // 312px spacing between rows
            int leftPosition = 22 + (col * 422); // 422px spacing between columns (412px width + 10px gap)

            <!-- Car Card -->
            <div data-estado="Default" style="width: 412px; height: 296px; padding-left: 10px; padding-right: 10px; padding-top: 8px; padding-bottom: 8px; left: @(leftPosition)px; top: @(topPosition)px; position: absolute; border-radius: 4px; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex; cursor: pointer;" onclick="window.location.href='@Url.Page("/Producto", new { id = auto.Id })'">
            @* Bander�n Tag - Primera capa, encima de todo *@
            @if (!string.IsNullOrEmpty(auto.BanderinVideoUrl))
            {
                <div style="position: absolute; top: -22px; right: 2px; width: 104px; height: 103px; pointer-events: none; z-index: 100;">
                    @if (auto.BanderinVideoUrl.EndsWith(".gif", StringComparison.OrdinalIgnoreCase))
                    {
                        <img src="@auto.BanderinVideoUrl" style="width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));" alt="Bander�n" />
                    }
                    else
                    {
                        <video autoplay loop muted playsinline preload="auto" style="width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));">
                            <source src="@auto.BanderinVideoUrl" type="video/mp4">
                        </video>
                    }
                </div>
            }
                <div style="align-self: stretch; flex: 1 1 0; position: relative; overflow: hidden; border-radius: 4px; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: flex">
                    <img style="align-self: stretch; height: 209px; padding: 8px; border-radius: 4px; object-fit: cover;" src="@(string.IsNullOrEmpty(auto.ImagenPrincipal) ? "https://placehold.co/392x209" : auto.ImagenPrincipal)" alt="@auto.NombreCompleto" />


                    <div style="width: 355px; left: 0px; top: 225px; position: absolute; text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 20px; font-family: Montserrat; font-weight: 700; word-wrap: break-word">@auto.NombreCompleto</div>
                    <div style="left: 0px; top: 263px; position: absolute; text-box-trim: trim-both; text-box-edge: cap alphabetic; color: white; font-size: 20px; font-family: Montserrat; font-weight: 500; word-wrap: break-word">@auto.PrecioEnCRC</div>

                    <!-- Share Icon -->
                    <div style="width: 16.67px; height: 20px; left: 375.33px; top: 260px; position: absolute; background: white"></div>

                    <!-- Favorite Icon -->
                    <div data-estado="Favoritos" style="left: 371px; top: 225px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: flex">
                        <div style="width: 20px; height: 17px; background: white; outline: 2px white solid; outline-offset: -1px"></div>
                    </div>
                </div>
                
                @if (auto.PlanVisibilidad > 1)
                {
                    <!-- Premium Badge -->
                    <img style="width: 104px; height: 102.84px; left: 292px; top: -4px; position: absolute" src="https://placehold.co/104x103" />
                }
            </div>

            currentIndex++;
        }

        <!-- Advertisement Slots -->
        @if (totalCars >= 3)
        {
            <!-- First Advertisement (after 3rd car, in position where 4th car would be) - Carousel Cuadrado -->
            <div style="width: 393px; height: 281.27px; left: 444.50px; top: 488px; position: absolute;">
                @await Component.InvokeAsync("CarruselPublicidad", new { formato = "cuadrado", seccion = "recien-vistos-primero" })
            </div>
        }

        @if (totalCars >= 12)
        {
            <!-- Second Advertisement (after 12 cars) - Carousel Horizontal -->
            <div style="width: 1010px; height: 196px; left: 135px; top: @(169 + ((totalCars / 3 + 1) * 312))px; position: absolute;">
                @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "recien-vistos-segundo" })
            </div>
        }

        <!-- Pagination -->
        <div style="width: 468px; height: 44px; left: 50%; top: @(169 + ((totalCars / 3 + 2) * 312))px; position: absolute; transform: translateX(-50%);">
            <div data-property-1="Default" style="width: 40px; left: 0px; top: 1px; position: absolute; border-radius: 40px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="width: 40px; height: 40px; position: relative; transform: rotate(180deg); transform-origin: top left">
                    <div style="width: 38.05px; height: 38.05px; left: 0.98px; top: 0.98px; position: absolute; outline: 1px white solid; outline-offset: -0.50px"></div>
                    <div style="width: 16.69px; height: 14.37px; left: 11.04px; top: 12.82px; position: absolute; background: white"></div>
                </div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 50px; top: 0px; position: absolute; background: rgba(255, 255, 255, 0.25); border-radius: 44px; outline: 2px white solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">1</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 104px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">2</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 158px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">3</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 212px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">4</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 266px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">5</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 320px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">…</div>
            </div>
            <div style="width: 44px; height: 44px; padding: 2px; left: 374px; top: 0px; position: absolute; border-radius: 44px; outline: 2px rgba(255, 255, 255, 0.75) solid; outline-offset: -2px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 12px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">@((totalCars / 9) + 1)</div>
            </div>
            <div data-property-1="Default" style="width: 40px; left: 468px; top: 41px; position: absolute; transform: rotate(180deg); transform-origin: top left; border-radius: 40px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                <div style="width: 40px; height: 40px; position: relative; transform: rotate(180deg); transform-origin: top left">
                    <div style="width: 38.05px; height: 38.05px; left: 0.98px; top: 0.98px; position: absolute; outline: 1px white solid; outline-offset: -0.50px"></div>
                    <div style="width: 16.69px; height: 14.37px; left: 12.27px; top: 12.82px; position: absolute; background: white"></div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div style="width: 100%; height: 400px; left: 0px; top: 300px; position: absolute; flex-direction: column; justify-content: center; align-items: center; gap: 32px; display: inline-flex">
            <div style="width: 80px; height: 80px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; flex-direction: column; justify-content: center; align-items: center; display: flex">
                <div style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.3)"></div>
            </div>
            <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: white; font-size: 24px; font-family: Montserrat; font-weight: 700; word-wrap: break-word">No has visto ningún auto recientemente</div>
            <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; text-align: center; color: rgba(255, 255, 255, 0.7); font-size: 16px; font-family: Montserrat; font-weight: 400; word-wrap: break-word">Explora nuestro catálogo de autos y los verás aparecer aquí</div>
            <div data-estado="Default" style="padding: 16px; background: white; border-radius: 4px; justify-content: center; align-items: center; gap: 8px; display: inline-flex; cursor: pointer;" onclick="window.location.href='@Url.Page("/Index")'">
                <div style="text-box-trim: trim-both; text-box-edge: cap alphabetic; color: #06174D; font-size: 16px; font-family: Montserrat; font-weight: 700; word-wrap: break-word">Explorar autos</div>
            </div>
        </div>
    }

    <!-- Espacio Publicitario -->
    <div style="margin: 48px auto; max-width: 1200px; padding: 0 32px;">
        @await Component.InvokeAsync("CarruselPublicidad", new { formato = "horizontal", seccion = "recien-vistos-footer" })
    </div>

    <!-- Footer -->
</div>





