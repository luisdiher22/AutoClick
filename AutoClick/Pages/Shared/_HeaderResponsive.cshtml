<!-- Header Responsive (Mobile & Tablet) -->
<header class="header-responsive">
    <div class="header-responsive-container">
        <!-- Logo -->
        <a asp-page="/Index" class="logo-responsive">
            <img src="~/images/logos/autoclick-logo-hd.png" alt="AutoClick.cr" />
        </a>
        
        <!-- Actions -->
        <div class="header-responsive-actions">
            @{
                var currentPage = ViewContext.RouteData.Values["page"]?.ToString() ?? "";
                var isIndexPage = currentPage == "/Index" || currentPage == "" || currentPage == "/" || ViewContext.HttpContext.Request.Path == "/" || ViewContext.HttpContext.Request.Path == "/Index";
            }
            
            <!-- Search Button (Solo en Index) -->
            @if (isIndexPage)
            {
                <a asp-page="/BusquedaAvanzada" class="search-btn-index" title="Búsqueda">
                    <img src="~/images/icons/search-icon.svg" alt="Búsqueda" />
                    <span>Búsqueda</span>
                </a>
            }
            
            <!-- Menu/Close Button -->
            <button class="menu-btn" id="menuBtn" aria-label="Menú">
                <img src="~/images/icons/menu-icon.svg" alt="Menú" class="menu-icon" />
                <img src="~/images/icons/close-icon.svg" alt="Cerrar" class="close-icon" style="display: none;" />
                <span class="menu-text">Menú</span>
                <span class="close-text" style="display: none;">Cerrar</span>
            </button>
        </div>
    </div>
    
    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-content">
            @{
                bool isUserLoggedIn = User.Identity?.IsAuthenticated == true;
                string userName = User.Identity?.Name ?? User.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value ?? User.FindFirst("FullName")?.Value ?? "Usuario";
            }
            
            @if (!isUserLoggedIn)
            {
                <!-- Auth Section (No logueado - aparece primero) -->
                <div class="menu-auth-section">
                    <a asp-page="/Auth" class="menu-item menu-item-auth">Inicie sesión / Registro</a>
                </div>
            }
            
            <!-- Main Navigation -->
            <a asp-page="/BusquedaAvanzada" class="menu-item menu-item-primary">Explorar todos los autos</a>
            <div class="menu-divider"></div>
            
            <!-- Anúnciese Section -->
            <button class="menu-section-btn" data-section="anunciese">
                <span>Anúnciese</span>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="arrow-icon">
                    <path d="M3 5L7 9L11 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="menu-section" id="section-anunciese">
                <a asp-page="/AnunciarMiAuto" class="menu-item menu-item-secondary">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="8" cy="8" r="6" stroke="white" stroke-width="1.5"/>
                    </svg>
                    Anunciar mi auto
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary">
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="9" stroke="white" stroke-width="2"/>
                    </svg>
                    Anunciarme como agencia
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="3" width="14" height="14" stroke="white" stroke-width="1.5"/>
                    </svg>
                    Anunciar mi empresa
                </a>
            </div>
            
            <!-- Productos Section -->
            <button class="menu-section-btn" data-section="productos">
                <span>Productos</span>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="arrow-icon">
                    <path d="M3 5L7 9L11 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="menu-section" id="section-productos">
                <a asp-page="/PpfCeramico" class="menu-item menu-item-secondary menu-item-product">
                    <img src="~/images/logos/RAINXLOGO.png" alt="Rain-X" class="product-logo-small" />
                    <span>¡Máxima visibilidad al conducir!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
            </div>
            
            <!-- Servicios Section -->
            <button class="menu-section-btn" data-section="servicios">
                <span>Servicios</span>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="arrow-icon">
                    <path d="M3 5L7 9L11 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="menu-section" id="section-servicios">
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
            </div>
            
            <!-- Financiamiento Section -->
            <button class="menu-section-btn" data-section="financiamiento">
                <span>Financiamiento</span>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="arrow-icon">
                    <path d="M3 5L7 9L11 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="menu-section" id="section-financiamiento">
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
                <a asp-page="/AnunciarEmpresa" class="menu-item menu-item-secondary menu-item-reserve">
                    Espacio disponible <span class="highlight">¡Reserve ya!</span>
                </a>
            </div>
            
            @if (isUserLoggedIn)
            {
                <!-- User Section (aparece después de los desplegables) -->
                <div class="menu-user-section">
                    <div class="menu-divider"></div>
                    <a asp-page="/MiPerfil" class="menu-item">
                        <svg width="13" height="16" viewBox="0 0 13 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 15C1 12.2386 3.68629 10 7 10C10.3137 10 13 12.2386 13 15M10 4.5C10 6.15685 8.65685 7.5 7 7.5C5.34315 7.5 4 6.15685 4 4.5C4 2.84315 5.34315 1.5 7 1.5C8.65685 1.5 10 2.84315 10 4.5Z" stroke="white" stroke-width="1.5"/>
                        </svg>
                        Mi perfil
                    </a>
                    <a asp-page="/Guardados" class="menu-item">
                        <svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 14.35L7.55 13.03C2.4 8.36 0 5.78 0 2.5C0 0.42 1.42 0 2.5 0C4.24 0 5.91 0.81 7 2.09C8.09 0.81 9.76 0 11.5 0C13.58 0 15 0.42 15 2.5C15 5.78 12.6 8.36 7.45 13.04L9 14.35Z" fill="white"/>
                        </svg>
                        Autos guardados
                    </a>
                    <a asp-page="/AnunciarMiAuto" class="menu-item">
                        <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 8.5C4 8.5 5.5 6 9.5 6C13.5 6 15 8.5 15 8.5M15 8.5C15 8.5 13.5 11 9.5 11C5.5 11 4 8.5 4 8.5" stroke="white" stroke-width="1.5"/>
                        </svg>
                        Anunciar mi auto
                    </a>
                    <a asp-page="/MisAnuncios" class="menu-item">
                        <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="2" width="17" height="17" stroke="white" stroke-width="1.5"/>
                        </svg>
                        Mis anuncios
                    </a>
                </div>
                
                <!-- Logout Button -->
                <div class="menu-logout-section">
                    <a asp-page="/Auth/Logout" class="menu-logout-btn">Cerrar sesión</a>
                </div>
            }
        </div>
    </div>
</header>

<script>
    // Menu JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        const menuBtn = document.getElementById('menuBtn');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuIcon = menuBtn.querySelector('.menu-icon');
        const closeIcon = menuBtn.querySelector('.close-icon');
        const menuText = menuBtn.querySelector('.menu-text');
        const closeText = menuBtn.querySelector('.close-text');
        
        function openMenu() {
            menuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Cambiar icono de menú a cerrar
            menuIcon.style.display = 'none';
            closeIcon.style.display = 'block';
            menuText.style.display = 'none';
            closeText.style.display = 'block';
        }
        
        function closeMenu() {
            menuOverlay.classList.remove('active');
            document.body.style.overflow = '';
            
            // Cambiar icono de cerrar a menú
            menuIcon.style.display = 'block';
            closeIcon.style.display = 'none';
            menuText.style.display = 'block';
            closeText.style.display = 'none';
            
            // Cerrar todas las secciones desplegables
            document.querySelectorAll('.menu-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.menu-section-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }
        
        if (menuBtn) {
            menuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (menuOverlay.classList.contains('active')) {
                    closeMenu();
                } else {
                    openMenu();
                }
            });
        }
        
        // Toggle de secciones desplegables
        document.querySelectorAll('.menu-section-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionName = this.getAttribute('data-section');
                const section = document.getElementById('section-' + sectionName);
                const isOpen = section.classList.contains('active');
                
                // Cerrar todas las secciones
                document.querySelectorAll('.menu-section').forEach(s => {
                    s.classList.remove('active');
                });
                document.querySelectorAll('.menu-section-btn').forEach(b => {
                    b.classList.remove('active');
                });
                
                // Abrir/cerrar la sección actual
                if (!isOpen) {
                    section.classList.add('active');
                    this.classList.add('active');
                }
            });
        });
        
        // Close menu when clicking outside
        if (menuOverlay) {
            menuOverlay.addEventListener('click', function(e) {
                if (e.target === menuOverlay) {
                    closeMenu();
                }
            });
        }
        
        // Close menu on menu item click (no en section buttons)
        const menuItems = document.querySelectorAll('.menu-item:not(.menu-section-btn)');
        menuItems.forEach(item => {
            item.addEventListener('click', closeMenu);
        });
    });
</script>
